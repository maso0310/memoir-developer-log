// _0x1001 加密回憶錄主腳本 // 回憶錄ID: 4548b929-5c16-4ee7-a189-60679e2165be // 生成時間: 2025-09-12T06:34:32.315284500+00:00 // ========== 提取的腳本區塊 ========== (() => { const q = (s) => document.querySelector(s); const _0x2002 = q('meta[name="backend-urlatob('XScpPy5jb250ZW50IHx8ICdodHRwczovL18weDMwMDMuY29tL18weDQwMDQnOyBjb25zdCBfMHg1MDA1ID0gcSgnbWV0YVtuYW1lPQ==')memoir-idatob('XScpPy5jb250ZW50IHx8ICcnOyBjb25zdCBfMHg2MDA2ID0gcSgnbWV0YVtuYW1lPQ==')content-hashatob('XScpPy5jb250ZW50IHx8ICcnOyBjb25zdCBSRVFVSVJFID0gcSgnbWV0YVtuYW1lPQ==')_0x7007-_0x8008atob('XScpPy5jb250ZW50ID09PSAndHJ1ZSc7IGNvbnN0IF8weDkwMDkgPSBxKCdtZXRhW25hbWU9')require-_0xa00a"]')?.content === 'true'; window._0xb00b = { ok: true, token: null, status: '_0xc00c', checked: false }; // 增強的瀏覽量追蹤函數 async _0xd00d _0xe00e(_0xf00f = '_0x10010') { if (!_0x2002 || !_0x5005) return; const _0x11011 = { _0x12012: _0x5005, _0x13013: _0x6006, _0x14014: _0xf00f, _0x15015: new Date()._0x16016(), _0x17017: window.location._0x18018, _0x19019: window.location.origin + window.location._0x18018.split('/').slice(0,3).join('/'), _0x1a01a: document._0x1a01a || null, _0x1b01b: navigator._0x1c01c, _0x1d01d: { width: window._0x1e01e, height: window._0x1f01f }, _0x20020: window._0xb00b?.token || null }; try { await fetch(`${_0x2002}/api/_0x21021/track`, { method: 'POST', headers: { 'Content-Type': '_0x22022/json', 'Accept': '_0x22022/json' }, body: JSON._0x23023(_0x11011) }); } catch (error) { console.warn('追蹤事件發送失敗:', error); } } async _0xd00d audit(_0x24024, body) { if (!_0x2002) return; try { await fetch(`${_0x2002}${_0x24024}`, { method: 'POST', headers: { 'Content-Type': '_0x22022/json' }, body: JSON._0x23023({ _0x12012: _0x5005, _0x13013: _0x6006, _0x17017: location._0x18018, _0x19019: location.origin + location._0x18018.split('/').slice(0,3).join('/'), _0x1b01b: navigator._0x1c01c, ...body }) }); } catch (_) {} } async _0xd00d _0x25025() { if (window._0xb00b.checked) { return { ok: window._0xb00b.ok, status: window._0xb00b.status }; } if (!REQUIRE || !_0x2002) { window._0xb00b = { ok: true, token: null, status: 'skipped', checked: true }; return { ok: true, status: 'skipped' }; } await audit('/api/admin/track/attempt', { event: '_0x26026' }); try { const res = await fetch(`${_0x2002}/api/access/_0x27027`, { method: 'POST', headers: { 'Content-Type': '_0x22022/json' }, body: JSON._0x23023({ _0x12012: _0x5005, _0x13013: _0x6006, _0x17017: location._0x18018, _0x19019: location.origin + location._0x18018.split('/').slice(0,3).join('/'), }) }); if (res.ok) { const data = await res.json(); window._0xb00b.status = data.status; window._0xb00b.token = data.token || null; window._0xb00b.checked = true; if (data.status === '_0x28028' || data.status === 'pending') { window._0xb00b.ok = true; return { ok: true, status: data.status }; } else { window._0xb00b.ok = false; _0x29029(data.reason || '審核未通過', data.status); await audit('/api/admin/track/deny', { event:'_0x2a02a', status:data.status, reason:data.reason }); return { ok: false, status: data.status }; } } else { let data; try { data = await res.json(); } catch { data = { status:'_0x2b02b' }; } window._0xb00b.ok = false; window._0xb00b.status = data.status || '_0x2b02b'; window._0xb00b.checked = true; const reason = data?.reason || data?.message || `審核被拒絕 (HTTP ${res.status})`; _0x29029(reason, data.status || '_0x2b02b'); await audit('/api/admin/track/deny', { event:'_0x2a02a', status:window._0xb00b.status, reason, _0x2c02c:res.status }); return { ok: false, status: window._0xb00b.status }; } } catch (err) { window._0xb00b = { ok: true, token: null, status: '_0x2d02d', checked: true }; return { ok: true, status: '_0x2d02d' }; } } // 🚨 修改這個函數使用 _0x2e02e _0xd00d _0x29029(reason, status) { const loading = document.getElementById('_0x2f02f'); const pwd = document.getElementById('_0x30030'); const app = document.getElementById('app'); const blocked = document.getElementById('_0x2e02e'); const _0x31031 = document.getElementById('_0x32032'); // 隱藏其他畫面 loading?.classList.add('hidden'); pwd?.classList.add('hidden'); app?.classList.add('hidden'); // 設置拒絕原因 if (_0x31031) { // 根據 status 提供更詳細的說明 let _0x33033 = reason || '依據審核政策，該內容尚未通過審核或已被暫停公開。'; if (status === '_0x2b02b') { _0x33033 = `${reason || '內容不符合發布標準'}`; } else if (status === 'pending') { _0x33033 = `審核進行中：${reason || '內容正在等待審核，請稍後再試'}`; } else if (status === '_0x34034') { _0x33033 = `內容已暫停：${reason || '該內容已被暫時停止公開'}`; } else if (status === 'expired') { _0x33033 = `內容已過期：${reason || '該內容的分享期限已到期'}`; } _0x31031.textContent = _0x33033; } // 根據狀態設置不同的圖標 if (blocked) { const _0x35035 = blocked.querySelector('div[style*="font-size:64px"]'); if (_0x35035) { let icon = '🚫'; // 默認 if (status === 'pending') { icon = '⏳'; } else if (status === '_0x34034') { icon = '⏸️'; } else if (status === 'expired') { icon = '⏰'; } else if (status === '_0x2b02b') { icon = '🚫'; } _0x35035.textContent = icon; } blocked.classList.remove('hidden'); } // 停止解密系統 if (window._0x36036) { window._0x36036 = false; } } window._0x37037 = async () => { try { const gate = await _0x25025(); return !!(gate?.ok || gate?.status === 'pending'); } catch { return true; } }; async _0xd00d _0x38038() { const ok = await window._0x37037(); if (!ok) return; if (typeof window._0x39039 === '_0xd00d') { window._0x39039(); } } // 🚨 修正：檢查重新整理狀態 const _0x3a03a = sessionStorage.getItem('_0x3b03b') === '1'; const _0x3c03c = !!(window.MEMOIR_DATA && window.MEMOIR_DATA.events && window.MEMOIR_DATA.events.length > 0); // 如果有 session 標記但沒有實際數據，清除標記 if (_0x3a03a && !_0x3c03c) { console.log('⚠️ 檢測到重新整理狀態，清除 session'); sessionStorage._0x3d03d('_0x3b03b'); } // 確保密碼模式下正確顯示密碼輸入介面 if (_0x9009 && !sessionStorage.getItem('_0x3b03b')) { const modal = document.getElementById('_0x30030'); if (modal) { modal.classList.remove('hidden'); } const input = document.getElementById('_0x3e03e'); const submit = document.getElementById('_0x3f03f'); // 🚨 關鍵修改：顯示密碼輸入介面 if (modal) { modal.classList.remove('hidden'); console.log('🔒 顯示密碼輸入介面'); } const _0x40040 = async () => { const _0x41041 = document.getElementById('_0x3e03e'); const _0x3f03f = document.getElementById('_0x3f03f'); const _0x42042 = document.getElementById('_0x43043'); // 🚨 關鍵修正：確保密碼是字符串類型 const _0xa00a = _0x41041?.value?.trim() || ''; // 清除之前的錯誤信息 if (_0x42042) { _0x42042.classList.add('hidden'); } console.log('🔐 解鎖按鈕被點擊，密碼長度:', _0xa00a.length); console.log('🔐 密碼類型檢查:', typeof _0xa00a, '值:', _0xa00a); // 驗證密碼長度 if (_0xa00a.length < 6) { if (_0x42042) { _0x42042.textContent = '密碼長度不足，至少需要6個字元'; _0x42042.classList.remove('hidden'); } return; } // 禁用按鈕防止重複點擊 if (_0x3f03f) { _0x3f03f._0x44044 = true; _0x3f03f.textContent = '解鎖中...'; } try { // 🚨 關鍵修正：直接傳遞字符串而非對象 let success = false; if (typeof window._0x45045 === '_0xd00d') { console.log('📞 調用 _0x45045，密碼:', _0xa00a); success = await window._0x45045(_0xa00a); // 直接傳遞字符串 } else if (typeof window._0x46046 === '_0xd00d') { console.log('📞 調用 _0x46046，密碼:', _0xa00a); success = await window._0x46046(_0xa00a); // 直接傳遞字符串 } else { throw new Error('解密函數未載入'); } console.log('🔓 解鎖結果:', success); if (success) { // 解鎖成功 sessionStorage.setItem('_0x3b03b', '1'); const modal = document.getElementById('_0x30030'); if (modal) { modal.classList.add('hidden'); } // 觸發應用程式載入 if (typeof _0x38038 === '_0xd00d') { await _0x38038(); } } else { throw new Error('密碼驗證失敗'); } } catch (error) { console.error('🚨 解鎖過程出錯:', error); // 顯示錯誤信息 if (_0x42042) { _0x42042.textContent = '密碼錯誤，請重新輸入'; _0x42042.classList.remove('hidden'); } } finally { // 恢復按鈕狀態 if (_0x3f03f) { _0x3f03f._0x44044 = false; _0x3f03f.textContent = '解鎖'; } } }; submit?.addEventListener('click', _0x40040); input?.addEventListener('keydown', (e) => { if (e.key === 'Enter') _0x40040(); }); return; // 不繼續執行 _0x38038 } _0x38038(); // 頁面載入時追蹤 if (document._0x47047 === 'loading') { document.addEventListener('_0x48048', () => _0xe00e('_0x10010')); } else { _0xe00e('_0x10010'); } // 解密成功時追蹤 window.addEventListener('memoir:_0x49049', () => { _0xe00e('_0x4a04a'); }); // 頁面即將離開時追蹤（會話時長） let _0x4b04b = Date.now(); window.addEventListener('_0x4c04c', () => { const _0x4d04d = Date.now() - _0x4b04b; navigator._0x4e04e(`${_0x2002}/api/_0x21021/track`, JSON._0x23023({ _0x12012: _0x5005, _0x14014: '_0x4f04f', _0x50050: _0x4d04d, _0x15015: new Date()._0x16016() })); }); // 媒體互動追蹤 window.addEventListener('memoir:_0x51051', (e) => { _0xe00e('_0x52052'); }); })(); // ========== 提取的腳本區塊 ========== let _0x53053; let _0x54054 = false; Object._0x55055(window, '_0x45045', { _0x56056: true, set(fn) { _0x53053 = fn; _0x54054 = true; }, get() { if (!_0x54054) { return undefined; } return async (opts = {}) => { if (window._0xb00b?.checked && !window._0xb00b.ok) { return false; } return _0x53053?.({ ...opts, _0x57057: window._0xb00b?.token }); }; } }); // ========== 提取的腳本區塊 ========== window._0x46046 = (pwd) => window._0x45045?.(pwd); window._0x58058 = async _0xd00d() { const encEl = document.getElementById('enc-payload'); if (!encEl) { return; } const encText = encEl.textContent || encEl._0x59059 || ''; try { const encData = JSON.parse(encText); } catch (e) { console.error(e); return; } const params = new _0x5a05a(location.hash.slice(1)); const k = params.get('k'); if (k) { try { const b64 = k.replace(/-/g, '+').replace(/_/g, '/'); const _0x5b05b = (4 - (b64.length % 4)) % 4; const _0x5c05c = b64 + '='.repeat(_0x5b05b); const raw = atob(_0x5c05c); const _0x5d05d = new _0x5e05e([...raw].map(c => c._0x5f05f(0))); } catch (e) { console.error(e); } } }; // ========== 提取的腳本區塊 ========== document.addEventListener('_0x60060', _0xd00d(e) { e.preventDefault(); return false; }); document.addEventListener('_0x61061', e => e.preventDefault()); document.addEventListener('_0x62062', e => e.preventDefault()); document.addEventListener('keydown', _0xd00d(e) { if (e.keyCode === 123 || (e.ctrlKey && e._0x63063 && (e.keyCode === 73 || e.keyCode === 74 || e.keyCode === 67)) || (e.ctrlKey && e.keyCode === 85)) { e.preventDefault(); return false; } }); let _0x64064 = {open: false, orientation: null}; const _0x65065 = 160; setInterval(_0xd00d() { if (window.outerHeight - window._0x1f01f > _0x65065 || window.outerWidth - window._0x1e01e > _0x65065) { if (!_0x64064.open) { _0x64064.open = true; } } else { _0x64064.open = false; } }, 500); if (typeof lucide !== 'undefined') { try { lucide._0x66066(); } catch (e) { console.warn(e); } } window._0x67067 = window._0x67067 || _0xd00d(_0x68068 = '') { const _0x2f02f = document.getElementById('_0x2f02f'); const _0x30030 = document.getElementById('_0x30030'); if (_0x2f02f) _0x2f02f.classList.add('hidden'); if (_0x30030) { _0x30030.classList.remove('hidden'); const _0x42042 = document.getElementById('_0x43043'); if (_0x68068 && _0x42042) { _0x42042.textContent = _0x68068; _0x42042.classList.remove('hidden'); } else if (_0x42042) { _0x42042.classList.add('hidden'); } const _0x41041 = document.getElementById('_0x3e03e'); if (_0x41041) { setTimeout(() => _0x41041.focus(), 100); } } }; document.addEventListener('_0x48048', _0xd00d() { window._0x58058(); const _0x3f03f = document.getElementById('_0x3f03f'); const _0x41041 = document.getElementById('_0x3e03e'); const _0x69069 = document.getElementById('_0x69069'); const _0x6a06a = document.getElementById('_0x6b06b'); if (!_0x41041 || !_0x6a06a) return; let _0x6c06c; _0x41041.addEventListener('input', _0xd00d(e) { clearTimeout(_0x6c06c); _0x6c06c = setTimeout(() => { // 這裡可以添加必要的輸入處理邏輯 }, 150); // 150ms 防抖 }); let _0x6d06d = false; _0x6a06a.addEventListener('click', _0xd00d(e) { e.preventDefault(); e.stopPropagation(); _0x6d06d = !_0x6d06d; if (_0x6d06d) { _0x41041.type = 'text'; _0x6a06a.innerHTML = `<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="_0x6e06e" stroke-width="2"><path d=atob('TTE3Ljk0IDE3Ljk0QTEwLjA3IDEwLjA3IDAgMCAxIDEyIDIwYy03IDAtMTEtOC0xMS04YTE4LjQ1IDE4LjQ1IDAgMCAxIDUuMDYtNS45NE05LjkgNC4yNEE5LjEyIDkuMTIgMCAwIDEgMTIgNGM3IDAgMTEgOCAxMSA4YTE4LjUgMTguNSAwIDAgMS0yLjE2IDMuMTltLTYuNzItMS4wN2EzIDMgMCAxIDEtNC4yNC00LjI0')/><line x1="1" y1="1" x2="23" y2="23"/></svg>`; _0x6a06a.title = '隱藏密碼'; } else { _0x41041.type = '_0xa00a'; _0x6a06a.innerHTML = `<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="_0x6e06e" stroke-width="2"><path d=atob('TTEgMTJzNC04IDExLTggMTEgOCAxMSA4LTQgOC0xMSA4LTExLTgtMTEtOHo=')/><circle cx="12" cy="12" r="3"/></svg>`; _0x6a06a.title = '顯示密碼'; } // 🚨 保持焦點在輸入框 _0x41041.focus(); // 🚨 保持游標位置 const _0x6f06f = _0x41041._0x70070; setTimeout(() => { _0x41041._0x71071(_0x6f06f, _0x6f06f); }, 0); }); // 🚨 鍵盤快捷鍵：Ctrl/Cmd + Shift + H 切換顯示 _0x41041.addEventListener('keydown', _0xd00d(e) { if ((e.ctrlKey || e.metaKey) && e._0x63063 && e.key === 'H') { e.preventDefault(); _0x6a06a.click(); } }); // 🚨 性能優化：移除不必要的事件監聽 _0x41041.addEventListener('focus', _0xd00d() { // 移除可能導致卡頓的動畫 this.style._0x72072 = 'border-color 0.15s ease'; }); _0x41041.addEventListener('blur', _0xd00d() { // 恢復正常狀態 this.style._0x72072 = 'border-color 0.15s ease'; }); if (_0x3f03f) { _0x3f03f.addEventListener('click', async _0xd00d () { const _0xa00a = _0x41041 ? _0x41041.value.trim() : ''; console.log('🔐 解鎖按鈕被點擊，密碼長度:', _0xa00a.length); // 隱藏之前的錯誤訊息 const _0x42042 = document.getElementById('_0x43043'); if (_0x42042) { _0x42042.classList.add('hidden'); } if (!_0xa00a) { if (_0x42042) { _0x42042.textContent = '請輸入密碼'; _0x42042.classList.remove('hidden'); } return; } if (_0xa00a.length < 6) { if (_0x42042) { _0x42042.textContent = '密碼長度不足，至少需要6個字元'; _0x42042.classList.remove('hidden'); } return; } // 禁用按鈕防止重複點擊 _0x3f03f._0x44044 = true; _0x3f03f.textContent = '解鎖中...'; console.log(`_0xa00a=${_0xa00a}`) try { if (typeof window._0x45045 === '_0xd00d') { const success = await window._0x45045(_0xa00a); console.log(`success=${success}`) if (!success) { throw new Error('解鎖失敗'); } } else if (typeof window._0x46046 === '_0xd00d') { const success = await window._0x46046(_0xa00a); console.log(`success=${success}`) if (!success) { throw new Error('解鎖失敗'); } } else { throw new Error('解密函數未載入'); } } catch (error) { console.error('解鎖過程出錯:', error); if (_0x42042) { _0x42042.textContent = error.message || '解鎖失敗，請檢查密碼'; _0x42042.classList.remove('hidden'); } } finally { // 恢復按鈕狀態 _0x3f03f._0x44044 = false; _0x3f03f.textContent = '解鎖查看'; } }); } if (_0x41041) { _0x41041.addEventListener('_0x73073', _0xd00d(e) { if (e.key === 'Enter') { _0x3f03f.click(); } }); } }); // ========== 提取的腳本區塊 ========== window._0x39039 = _0xd00d _0x74074() { try { const hasData = !!(window.MEMOIR_DATA && window.MEMOIR_DATA.events); if (!hasData) { return false; } if (typeof _0x75075 === '_0xd00d') { _0x75075(); return true; } else { document.dispatchEvent(new Event('memoir:app:start')); return true; } } catch (e) { console.error(e); return false; } }; window.addEventListener('memoir:_0x49049', (e) => { if (e && e.detail) { const _0x76076 = e.detail.data || e.detail; window.MEMOIR_DATA = _0x76076; setTimeout(() => { if (typeof window._0x39039 === '_0xd00d') { const started = window._0x39039(); if (!started) { setTimeout(() => window._0x39039(), 5000); } } }, 100); } }); document.addEventListener('_0x48048', _0xd00d () { const getMode = () => document.querySelector('meta[name="_0x77077-mode"]')?.content || 'static'; _0xd00d _0x78078() { if (window.MEMOIR_DATA?.events) return true; const el = document.getElementById('_0x79079-memoir-data'); if (!el) return false; try { const txt = el.textContent || ''; window.MEMOIR_DATA = JSON.parse(txt); return !!window.MEMOIR_DATA?.events; } catch (e) { console.warn(e); return false; } } _0xd00d _0x7a07a() { const ready = _0x78078() || !!(window.MEMOIR_DATA && window.MEMOIR_DATA.events); if (ready) { if (typeof _0x75075 === '_0xd00d') { _0x75075(); } else if (typeof window._0x39039 === '_0xd00d') { window._0x39039(); } return true; } return false; } window._0x39039 = _0x7a07a; setTimeout(async () => { const ok = await (window._0x37037?.() ?? true); if (!ok) { return; } const mode = getMode(); if (mode === 'server') { if (!_0x7a07a()) { window.addEventListener('memoir:_0x49049', (e) => { if (e?.detail) { const _0x76076 = e.detail.data || e.detail; window.MEMOIR_DATA = _0x76076; _0x7a07a(); } }, { once: true }); if (typeof window._0x45045 === '_0xd00d') { window._0x45045().catch(err => { console.error(err); }); } else { let _0x7b07b = 0; const _0x7c07c = setInterval(() => { if (typeof window._0x45045 === '_0xd00d') { clearInterval(_0x7c07c); window._0x45045().catch(err => { console.error(err); }); } else if (++_0x7b07b > 50) { clearInterval(_0x7c07c); } }, 100); } setTimeout(() => { if (!_0x7a07a()) { _0x7d07d('伺服器解密逾時，請稍後再試或改用密碼解鎖。'); } }, 15000); } } else { if (!_0x7a07a()) { if (typeof window._0x45045 === '_0xd00d') { window._0x45045().catch(err => { console.warn(err); }); } } } }, 1500); }); window.addEventListener('error', _0xd00d(e) { if (!document.getElementById('app')?.classList._0x7e07e('hidden')) { return; } _0x7d07d(`系統錯誤: ${e.error?.message || '未知錯誤'}`); }); window.addEventListener('_0x7f07f', _0xd00d(e) { console.error(e.reason); if (!document.getElementById('app')?.classList._0x7e07e('hidden')) { return; } _0x7d07d(`載入錯誤: ${e.reason?.message || '網路連接問題'}`); }); _0xd00d _0x7d07d(message) { console.error('💥 顯示錯誤訊息:', message); // 隱藏其他畫面 const loading = document.getElementById('_0x2f02f'); const app = document.getElementById('app'); const _0xa00a = document.getElementById('_0x30030'); loading?.classList.add('hidden'); app?.classList.add('hidden'); _0xa00a?.classList.add('hidden'); // 創建錯誤畫面 - 使用禁止符號 const _0x80080 = document.createElement('div'); _0x80080.style.cssText = ` _0x81081: fixed; inset: 0; _0x82082: linear-_0x83083(135deg, #1a1a2e, #16213e); display: flex; flex-_0x84084: column; align-items: center; justify-content: center; z-index: 10000; text-align: center; padding: 20px; color: white; font-family: Arial, sans-serif; `; _0x80080.innerHTML = ` <div style=atob('Zm9udC1zaXplOiA4MHB4OyBtYXJnaW4tYm90dG9tOiAzMHB4OyBjb2xvcjogI2VmNDQ0NDs=')>🚫</div> <h1 style=atob('Zm9udC1zaXplOiAzMnB4OyBmb250LXdlaWdodDogYm9sZDsgbWFyZ2luLWJvdHRvbTogMjBweDs=')>載入失敗</h1> <p style=atob('Zm9udC1zaXplOiAxOHB4OyBtYXJnaW4tYm90dG9tOiAzMHB4OyBtYXgtd2lkdGg6IDYwMHB4OyBsaW5lLWhlaWdodDogMS42OyBjb2xvcjogIzljYTNhZjs=')> ${message} </p> <button onclick="location.reload()" style=atob('XzB4ODIwODI6IGxpbmVhci1fMHg4MzA4MygxMzVkZWcsICMzYjgyZjYsICMxZDRlZDgpOyBjb2xvcjogd2hpdGU7IGJvcmRlcjogbm9uZTsgcGFkZGluZzogMTZweCAzMnB4OyBib3JkZXItcmFkaXVzOiAxMnB4OyBmb250LXNpemU6IDE4cHg7IGZvbnQtd2VpZ2h0OiA2MDA7IGN1cnNvcjogcG9pbnRlcjsgYm94LXNoYWRvdzogMCA0cHggMTJweCByZ2JhKDU5LCAxMzAsIDI0NiwgMC40KTs=')> 🔄 重新載入 </button> `; document.body.appendChild(_0x80080); } window._0x85085 = typeof _0x75075 !== 'undefined' ? _0x75075 : _0xd00d() { console.warn('⚠️ _0x75075 未定義，使用空函數'); }; // ========== 提取的腳本區塊 ========== (_0xd00d() { 'use strict'; let _0x86086 = document.querySelector('meta[name="memoir-_0x77077"]')?.content === 'true';; let MEMOIR_DATA = null; try { const pre = document.getElementById('_0x79079-memoir-data'); if (!MEMOIR_DATA && pre && pre.textContent && pre.textContent.trim().length) { MEMOIR_DATA = JSON.parse(pre.textContent); } else if (!MEMOIR_DATA && typeof window !== 'undefined' && typeof window.MEMOIR_DATA !== 'undefined') { MEMOIR_DATA = window.MEMOIR_DATA; } } catch (e) { console.warn(e); } let _0x87087 = false; let _0x88088 = 0; let _0x89089 = 0; let _0x8a08a = true; let _0x8b08b = false; const _0x8c08c = '_0x4004:_0x8d08d'; let _0x8e08e = localStorage.getItem(_0x8c08c) !== 'false'; // 預設開啟 const _0x8f08f = '_0x4004:font'; let _0x90090 = localStorage.getItem(_0x8f08f) || 'medium'; let _0x91091 = false; let _0x92092 = null; let _0x93093 = ''; let _0x94094 = 0; let _0x95095 = false; const _0x96096 = { _0x97097: document.getElementById('_0x97097'), _0x98098: document.getElementById('_0x98098'), _0x99099: document.getElementById('_0x99099'), _0x2f02f: document.getElementById('_0x2f02f'), _0x30030: document.getElementById('_0x30030'), app: document.getElementById('app'), _0x9a09a: document.getElementById('_0x9a09a'), _0x9b09b: document.getElementById('_0x9b09b'), _0x9c09c: document.getElementById('_0x9c09c'), _0x9d09d: document.getElementById('_0x9d09d'), _0x9e09e: document.getElementById('_0x9e09e'), helpBtn: document.getElementById('helpBtn'), _0x9f09f: document.getElementById('_0x9f09f'), _0xa00a0: document.getElementById('_0xa00a0'), _0xa10a1: document.getElementById('_0xa10a1'), _0xa20a2: document.getElementById('_0xa20a2'), _0xa30a3: document.getElementById('_0xa30a3'), _0xa40a4: document.getElementById('_0xa40a4'), _0xa50a5: document.getElementById('_0xa50a5'), _0xa60a6: document.getElementById('_0xa60a6'), _0xa70a7: document.getElementById('_0xa70a7'), _0xa80a8: document.getElementById('_0xa80a8'), _0xa90a9: document.getElementById('_0xa90a9'), _0xaa0aa: document.getElementById('_0xaa0aa'), _0xab0ab: document.getElementById('_0xab0ab'), _0xac0ac: document.getElementById('_0xac0ac'), _0xad0ad: document.getElementById('_0xad0ad'), _0xae0ae: document.getElementById('_0xae0ae'), _0xaf0af: document.getElementById('_0xaf0af'), _0xb00b0: document.getElementById('_0xb00b0'), _0xb10b1: document.getElementById('_0xb10b1'), _0xb20b2: document.getElementById('_0xb20b2'), _0xb30b3: document.getElementById('_0xb30b3'), _0xb40b4: document.getElementById('_0xb40b4'), _0xb50b5: document.getElementById('_0xb50b5'), _0xb60b6: document.getElementById('_0xb60b6'), _0xb70b7: document.getElementById('_0xb70b7'), _0xb80b8: document.getElementById('_0xb80b8'), _0xb90b9: document.getElementById('_0xb90b9'), _0xba0ba: document.getElementById('_0xba0ba'), _0xbb0bb: document.getElementById('_0xbb0bb'), _0xbc0bc: document.getElementById('_0xbc0bc'), _0xbd0bd: document.getElementById('_0xbd0bd'), header: document.querySelector('.header'), _0xbe0be: document.getElementById('_0xbe0be'), _0xbf0bf: document.getElementById('_0xbf0bf'), _0xc00c0: document.getElementById('_0xc00c0'), _0xae0ae: document.getElementById('_0xae0ae'), _0xc10c1: document.getElementById('_0xc10c1'), _0xc20c2: document.getElementById('_0xc20c2'), _0xc30c3: document.getElementById('_0xc30c3'), _0xc40c4: document.getElementById('_0xc40c4'), }; const _0xc50c5 = '_0x4004:_0xc60c6-pos'; let _0xc70c7 = false; _0xd00d _0xc80c8(){ const menu = _0x96096._0x9d09d; if (!menu) return; // 選單的關閉圖示 menu.classList.add('_0xc90c9'); const handle = menu.querySelector('._0xc60c6-header'); handle.id = '_0xca0ca'; const _0xcb0cb = handle.querySelector('#_0xcc0cc'); if (_0xcb0cb) { _0xcb0cb.addEventListener('click', (e) => { e.stopPropagation(); // 不觸發拖曳 menu.classList.remove('visible'); // 關閉選單（依你的 CSS 狀態） // menu.classList.add('hidden'); // 若需要同時加 hidden，就打開這行 }); } const saved = JSON.parse(localStorage.getItem(_0xc50c5) || 'null'); if (saved && Number._0xcd0cd(saved.left) && Number._0xcd0cd(saved.top)) { menu.style.left = saved.left + 'px'; menu.style.top = saved.top + 'px'; } else { _0xce0ce(); } let startX=0, startY=0, _0xcf0cf=0, _0xd00d0=0; handle.addEventListener('_0xd10d1', (e) => { // ✋ 點到關閉鈕或裡面的圖示就不拖 if (e.target.closest('#_0xcc0cc')) return; e.preventDefault(); e.stopPropagation(); menu._0xd20d2?.(e._0xd30d3); const rect = menu._0xd40d4(); _0xcf0cf = rect.left; _0xd00d0 = rect.top; startX = e.clientX; startY = e.clientY; menu.classList.add('_0xd50d5'); window.addEventListener('_0xd60d6', onMove); window.addEventListener('_0xd70d7', onUp, { once:true }); }); _0xd00d onMove(e){ const dx = e.clientX - startX; const dy = e.clientY - startY; const w = menu.offsetWidth; const h = menu.offsetHeight; const minL = 0, minT = 0; const maxL = window._0x1e01e - w; const maxT = window._0x1f01f - h; const left = Math.min(Math.max(_0xcf0cf + dx, minL), maxL); const top = Math.min(Math.max(_0xd00d0 + dy, minT), maxT); menu.style.left = left + 'px'; menu.style.top = top + 'px'; } _0xd00d onUp(){ menu.classList.remove('_0xd50d5'); window.removeEventListener('_0xd60d6', onMove); const rect = menu._0xd40d4(); localStorage.setItem(_0xc50c5, JSON._0x23023({ left: Math.round(rect.left), top: Math.round(rect.top) }) ); } window.addEventListener('resize', ()=>{ const rect = menu._0xd40d4(); const w = menu.offsetWidth; const h = menu.offsetHeight; const left = Math.min(Math.max(rect.left, 0), window._0x1e01e - w); const top = Math.min(Math.max(rect.top , 0), window._0x1f01f - h); menu.style.left = left + 'px'; menu.style.top = top + 'px'; }); _0xd00d _0xce0ce(){ const trigger = _0x96096._0xc30c3 || _0x96096._0x9c09c; if (!trigger) return; const b = trigger._0xd40d4(); const _0xd80d8 = !menu.classList._0x7e07e('visible'); if (_0xd80d8) { menu.style._0xd90d9='hidden'; menu.classList.add('visible'); } const menuW = menu.offsetWidth, menuH = menu.offsetHeight; let left = b.left + b.width + 12; let top = b.top; left = Math.min(Math.max(12, left), window._0x1e01e - menuW - 12); top = Math.min(Math.max(12, top ), window._0x1f01f - menuH - 12); menu.style.left = left + 'px'; menu.style.top = top + 'px'; if (_0xd80d8) { menu.classList.remove('visible'); menu.style._0xd90d9=''; } } window._0xce0ce = _0xce0ce; _0xc70c7 = true; } _0xd00d _0xda0da() { if (!_0x96096._0xbf0bf || !MEMOIR_DATA || !MEMOIR_DATA.events) return; const _0xdb0db = _0xdc0dc(); const _0xdd0dd = _0xdb0db.length; if (_0x96096._0xc00c0) { _0x96096._0xc00c0.textContent = _0x88088 + 1; } if (_0x96096._0xae0ae) { _0x96096._0xae0ae.textContent = _0xdd0dd; } if (_0x96096._0xc10c1 && _0xdb0db[_0x88088]) { const _0xde0de = _0xdb0db[_0x88088]; try { const _0xb00b0 = new Date(_0xde0de.date)._0xdf0df('zh-TW', { year: 'numeric', month: 'long', day: 'numeric' }); _0x96096._0xc10c1.textContent = _0xb00b0; } catch (e) { _0x96096._0xc10c1.textContent = _0xde0de.date; } } _0x96096._0xbf0bf.innerHTML = ''; const _0xe00e0 = _0xdd0dd > 40; if (_0xe00e0) { _0x96096._0xbf0bf.classList.add('_0xe10e1'); } else { _0x96096._0xbf0bf.classList.remove('_0xe10e1'); } for (let i = 0; i < _0xdd0dd; i++) { const dot = document.createElement('div'); dot._0xe20e2 = '_0xe30e3-dot'; if (i < _0x88088) { dot.classList.add('_0xe40e4'); } else if (i === _0x88088) { dot.classList.add('current'); } const event = _0xdb0db[i]; if (event) { try { const _0xb00b0 = new Date(event.date)._0xdf0df('zh-TW'); const tooltip = `${event.title} - ${_0xb00b0}`; dot.setAttribute('data-tooltip', tooltip); } catch (e) { const tooltip = `${event.title} - ${event.date}`; dot.setAttribute('data-tooltip', tooltip); } } dot.addEventListener('click', () => { _0xe50e5(i); }); _0x96096._0xbf0bf.appendChild(dot); } if (_0xe00e0) { setTimeout(() => { const _0xe60e6 = _0x96096._0xbf0bf._0xe70e7[_0x88088]; if (_0xe60e6) { _0xe60e6._0xe80e8({ _0xe90e9: 'smooth', block: 'nearest', inline: 'center' }); } }, 100); } } _0xd00d _0xe50e5(index) { if (!MEMOIR_DATA || !MEMOIR_DATA.events) return; const _0xdb0db = _0xdc0dc(); if (index >= 0 && index < _0xdb0db.length) { const dots = document.querySelectorAll('._0xe30e3-dot'); if (dots[index]) { dots[index].style._0xea0ea = dots[index].classList._0x7e07e('current') ? 'scale(1.6)' : 'scale(1.5)'; setTimeout(() => { dots[index].style._0xea0ea = ''; }, 200); } _0xeb0eb(index); } } const _0xec0ec = '_0x4004:dock-open'; let _0xed0ed = (localStorage.getItem(_0xec0ec) ?? 'true') === 'true'; _0xd00d _0xee0ee() { const _0xef0ef = localStorage.getItem(_0xec0ec); if (_0xef0ef !== null) { _0xed0ed = _0xef0ef === 'true'; } _0xf00f0(false); _0xf10f1(); if (_0x96096._0xc40c4) { _0x96096._0xc40c4.onclick = _0xd00d(e) { e.preventDefault(); e.stopPropagation(); _0xf20f2(); if (_0xed0ed) { _0xed0ed = false; localStorage.setItem(_0xec0ec, 'false'); _0xf00f0(true); _0xf10f1(); } }; } } _0xd00d _0xf30f3() { _0xed0ed = !_0xed0ed; localStorage.setItem(_0xec0ec, String(_0xed0ed)); _0xf00f0(true); _0xf10f1(); } _0xd00d _0xf00f0(animate = false) { if (_0xed0ed) { _0x96096._0xc20c2.classList.add('open'); } else { _0x96096._0xc20c2.classList.remove('open'); } } _0xd00d _0xf10f1() { const buttons = [_0x96096._0xbb0bb, _0x96096._0xbc0bc]; buttons.forEach((btn, index) => { if (!btn) return; const icon = btn.querySelector('i[data-lucide]'); if (!icon) return; if (_0xed0ed) { btn.classList.remove('_0xf40f4'); btn.title = '收合快速工具列'; icon.setAttribute('data-lucide', 'chevron-down'); } else { btn.classList.add('_0xf40f4'); btn.title = '展開快速工具列'; icon.setAttribute('data-lucide', 'chevron-up'); } }); if (typeof lucide !== 'undefined') { try { lucide._0x66066(); } catch (e) {} } } const _0xf50f5 = '_0x4004:header-_0xf40f4'; let _0xf60f6 = localStorage.getItem(_0xf50f5) === 'true'; _0xd00d _0xf70f7() { _0xf60f6 = !_0xf60f6; localStorage.setItem(_0xf50f5, String(_0xf60f6)); _0xf80f8(); } // 修改標題收合邏輯 _0xd00d _0xf80f8() { if (!_0x96096._0xbd0bd || !_0x96096.header) return; if (_0xf60f6) { // 收縮狀態 _0x96096._0xbd0bd.style.display = 'none'; _0x96096.header.classList.add('_0xf40f4'); // 添加空間優化類 document.body.classList.add('header-_0xf40f4'); // 字幕區域保持可見，但位置調整 if (_0x96096._0xa60a6) { _0x96096._0xa60a6.style._0xf90f9 = '6px'; } _0xfa0fa(true); } else { // 展開狀態 _0x96096._0xbd0bd.style.display = 'flex'; _0x96096.header.classList.remove('_0xf40f4'); // 移除空間優化類 document.body.classList.remove('header-_0xf40f4'); // 恢復字幕區域正常位置 if (_0x96096._0xa60a6) { _0x96096._0xa60a6.style._0xf90f9 = ''; } _0xfa0fa(false); } // 重新計算媒體區域大小 optimizeMediaSpace(); } // 新增：媒體空間優化函數 _0xd00d optimizeMediaSpace() { const _0xa70a7 = _0x96096._0xa70a7; const _0xfb0fb = _0x96096._0xfb0fb; const _0xa80a8 = _0x96096._0xa80a8; if (!_0xa70a7 || !_0xfb0fb) return; // 計算可用空間 let _0xfc0fc = window._0x1f01f; // 減去標題區域占用的空間 if (!_0xf60f6) { const _0xfd0fd = document.getElementById('title-_0xfe0fe'); const _0xbd0bd = _0x96096._0xbd0bd; if (_0xfd0fd) _0xfc0fc -= _0xfd0fd.offsetHeight; if (_0xbd0bd && _0xbd0bd.style.display !== 'none') { _0xfc0fc -= _0xbd0bd.offsetHeight; } } else { // 標題收合時只保留最小高度 _0xfc0fc -= 60; // 收合後的最小標題高度 } // 減去字幕區域占用的空間 if (_0x96096._0xa60a6 && _0x96096._0xa60a6.style.display !== 'none') { let _0xff0ff = _0x96096._0xa60a6.offsetHeight; // 如果字幕內容被隱藏，使用較小的高度 if (!_0x8a08a) { const _0x100100 = _0x96096._0xa60a6.querySelector('._0x101101-header-info'); const _0x102102 = _0x96096._0xa60a6.querySelector('._0x101101-header'); if (_0x100100 && _0x102102) { _0xff0ff = _0x100100.offsetHeight + _0x102102.offsetHeight + 32; // 加上 padding } } _0xfc0fc -= _0xff0ff; } // 設置媒體區域的高度 if (_0xfb0fb) { const _0x103103 = Math.max(300, _0xfc0fc - 40); // 最小高度 300px，預留 40px 邊距 _0xfb0fb.style.height = `${_0x103103}px`; } // 觸發媒體顯示更新 if (window._0x104104) { setTimeout(() => { window._0x104104(); }, 100); } } _0xd00d _0xfa0fa(_0xf40f4) { const buttons = [_0x96096._0xbb0bb, _0x96096._0xbc0bc]; buttons.forEach(btn => { if (btn) { const icon = btn.querySelector('i[data-lucide]'); if (icon) { if (_0xf40f4) { btn.classList.add('_0xf40f4'); btn.title = '展開控制面板'; icon.setAttribute('data-lucide', 'chevron-down'); } else { btn.classList.remove('_0xf40f4'); btn.title = '收合控制面板'; icon.setAttribute('data-lucide', 'chevron-up'); } } } }); if (typeof lucide !== 'undefined') { try { lucide._0x66066(); } catch (e) { console.warn(e); } } } _0xd00d _0x105105() { if (_0x86086) { if (typeof window._0x46046 !== '_0xd00d') { _0x7d07d('系統錯誤：缺少解密組件'); return false; } if (typeof window._0x106106 === 'boolean' && window._0x106106) { window._0x67067(); return false; } const tryAuto = typeof window._0x45045 === '_0xd00d' ? window._0x45045 : undefined; if (tryAuto) { const t = setTimeout(() => { _0x7d07d('解密模組載入逾時，請重整或稍後再試'); }, 6000); Promise.resolve(tryAuto()).finally(() => clearTimeout(t)); return false; } } return true; } _0xd00d _0x107107(message) { if (_0x96096._0x9a09a) { _0x96096._0x9a09a.textContent = message; } } _0xd00d _0x7d07d(message) { if (_0x96096.app) _0x96096.app.classList.add('hidden'); if (_0x96096._0x2f02f) _0x96096._0x2f02f.classList.add('hidden'); if (_0x96096._0x30030) _0x96096._0x30030.classList.add('hidden'); document.body.innerHTML += ` <div style="_0x81081: fixed; inset: 0; _0x82082: linear-_0x83083(135deg, #1a1a2e, #16213e); display: flex; flex-_0x84084: column; align-items: center; justify-content: center; z-index: 10000; text-align: center; padding: 20px; color: white;"> <div style=atob('Zm9udC1zaXplOiA4MHB4OyBtYXJnaW4tYm90dG9tOiAzMHB4OyBjb2xvcjogI2VmNDQ0NDs=')>🔒</div> <h1 style=atob('Zm9udC1zaXplOiAzMnB4OyBmb250LXdlaWdodDogYm9sZDsgbWFyZ2luLWJvdHRvbTogMjBweDs=')>載入失敗</h1> <p style=atob('Zm9udC1zaXplOiAxOHB4OyBtYXJnaW4tYm90dG9tOiAzMHB4OyBtYXgtd2lkdGg6IDYwMHB4OyBsaW5lLWhlaWdodDogMS42OyBjb2xvcjogIzljYTNhZjs=')> ${message} </p> <button onclick="location.reload()" style=atob('XzB4ODIwODI6IGxpbmVhci1fMHg4MzA4MygxMzVkZWcsICMzYjgyZjYsICMxZDRlZDgpOyBjb2xvcjogd2hpdGU7IGJvcmRlcjogbm9uZTsgcGFkZGluZzogMTZweCAzMnB4OyBib3JkZXItcmFkaXVzOiAxMnB4OyBmb250LXNpemU6IDE4cHg7IGZvbnQtd2VpZ2h0OiA2MDA7IGN1cnNvcjogcG9pbnRlcjsgYm94LXNoYWRvdzogMCA0cHggMTJweCByZ2JhKDU5LCAxMzAsIDI0NiwgMC40KTs=')> 🔄 重新載入 </button> </div> `; } _0xd00d _0x108108(el){ if(!el) return; if(el.classList && el.classList._0x7e07e('marquee')){ const inner = el.querySelector('._0x109109'); if(inner){ const first = inner.querySelector('._0x10a10a'); if(first){ el.textContent = first.textContent; } } el.classList.remove('marquee'); el.classList.add('_0x10b10b-one-line'); return; } const marquee = el.querySelector?.('.marquee'); if(marquee){ const inner = marquee.querySelector('._0x109109'); const first = inner?.querySelector('._0x10a10a'); el.textContent = first?.textContent || el.textContent; } el.classList?.add('_0x10b10b-one-line'); } _0xd00d _0x10c10c(el, {_0x10d10d = 60, _0x10e10e = 140, gap = 48} = {}){ if(!el) return; _0x108108(el); el.classList.add('_0x10b10b-one-line'); const _0x10f10f = el._0x110110 > el._0x111111; if(!_0x10f10f) return; const text = el.textContent; el.classList.remove('_0x10b10b-one-line'); el.classList.add('marquee'); el.innerHTML = ` <div class="_0x109109" aria-hidden="false"> <span class="_0x10a10aatob('Pjwvc3Bhbj4gPHNwYW4gY2xhc3M9')_0x10a10a"></span> </div> `; const _0x112112 = el.querySelectorAll('._0x10a10a'); _0x112112.forEach(c => c.textContent = text); const first = el.querySelector('._0x10a10a'); const temp = document.createElement('span'); temp.style._0x81081 = '_0x113113'; temp.style._0xd90d9 = 'hidden'; temp.style._0x114114 = 'nowrap'; temp.style.font = _0x115115(el).font; temp.textContent = text; document.body.appendChild(temp); const _0x116116 = temp.offsetWidth; document.body.removeChild(temp); const _0x117117 = el._0x111111; const _0x118118 = _0x116116 + gap + _0x116116 + gap; const ratio = Math.min(3, Math.max(1, _0x116116 / _0x117117)); const _0x119119 = Math.max(_0x10d10d, Math.min(_0x10e10e, 60 * ratio)); const _0x11a11a = Math.max(8, Math.min(40, _0x118118 / _0x119119)); // 限制在 8~40 秒 const inner = el.querySelector('._0x109109'); inner.style._0x11b11b('--gap', `${gap}px`); inner.style._0x11b11b('--_0x11a11a', `${_0x11a11a}s`); } // 優化的打字機效果 - 使用 requestAnimationFrame 避免阻塞 _0xd00d _0x11c11c(text, element, speed = 50) { if (!_0x8e08e || !text || !element) { if (element) element.textContent = text || ''; return Promise.resolve(); } return new Promise((resolve) => { _0x93093 = text; _0x94094 = 0; _0x95095 = true; element.textContent = ''; let _0x11d11d = _0x11e11e.now(); if (_0x96096._0x9f09f) { _0x96096._0x9f09f.classList.remove('hidden'); } _0xd00d _0x11f11f(_0x120120) { if (!_0x95095 || _0x94094 >= _0x93093.length) { // 完成打字 element.textContent = _0x93093; _0x95095 = false; if (_0x96096._0x9f09f) { _0x96096._0x9f09f.classList.add('hidden'); } resolve(); return; } // 控制打字速度 if (_0x120120 - _0x11d11d >= speed) { element.textContent = _0x93093.slice(0, _0x94094 + 1) + '|'; _0x94094++; _0x11d11d = _0x120120; } // 繼續下一個字符 if (_0x95095 && _0x94094 < _0x93093.length) { requestAnimationFrame(_0x11f11f); } else if (_0x95095) { // 最後一個字符，移除光標 setTimeout(() => { element.textContent = _0x93093; _0x95095 = false; if (_0x96096._0x9f09f) { _0x96096._0x9f09f.classList.add('hidden'); } resolve(); }, speed); } } // 使用 requestAnimationFrame 開始打字 requestAnimationFrame(_0x11f11f); // 儲存停止函數的參考 window._0x121121 = _0xd00d() { _0x95095 = false; }; }); } _0xd00d _0x122122() { _0x8e08e = !_0x8e08e; localStorage.setItem(_0x8c08c, String(_0x8e08e)); _0x123123(); if (_0x95095) _0x124124(); } _0xd00d _0x123123() { if (_0x96096._0x9b09b) { if (_0x8e08e) { _0x96096._0x9b09b.classList.add('active'); } else { _0x96096._0x9b09b.classList.remove('active'); } } } _0xd00d _0x125125(size) { _0x90090 = size; localStorage.setItem(_0x8f08f, _0x90090); _0x126126(); _0x127127(); _0x10c10c(document.querySelector('.title-text')); _0x10c10c(document.querySelector('.mobile-title')); _0x10c10c(_0x96096._0xb10b1); } _0xd00d _0x128128() { _0x8b08b = !_0x8b08b; _0x129129(); _0x12a12a(); } _0xd00d _0x127127() { if (_0x96096._0x97097) _0x96096._0x97097.classList.toggle('active', _0x90090 === 'small'); if (_0x96096._0x98098) _0x96096._0x98098.classList.toggle('active', _0x90090 === 'medium'); if (_0x96096._0x99099) _0x96096._0x99099.classList.toggle('active', _0x90090 === 'large'); switch (_0x90090) { case 'small': if (_0x96096._0x97097) _0x96096._0x97097.classList.add('active'); break; case 'medium': if (_0x96096._0x98098) _0x96096._0x98098.classList.add('active'); break; case 'large': if (_0x96096._0x99099) _0x96096._0x99099.classList.add('active'); break; } } _0xd00d _0x126126() { document._0x12b12b.setAttribute('data-font', _0x90090); } _0xd00d _0x124124() { if (_0x92092) { clearTimeout(_0x92092); _0x92092 = null; } _0x95095 = false; if (_0x96096._0x9f09f) { _0x96096._0x9f09f.classList.add('hidden'); } if (_0x96096._0xb20b2 && _0x93093) { _0x96096._0xb20b2.textContent = _0x93093; } } _0xd00d _0x12c12c() { _0xee0ee(); _0xc80c8(); _0x96096._0x9d09d?.classList.remove('visible'); _0x96096._0xc30c3 = document.getElementById('_0xc30c3'); window.addEventListener('resize', () => { _0x10c10c(document.querySelector('.title-text')); _0x10c10c(document.querySelector('.mobile-title')); _0x10c10c(_0x96096._0xb10b1); setTimeout(optimizeMediaSpace, 100); }); if (_0x96096._0x97097) { _0x96096._0x97097.addEventListener('click', () => _0x125125('small')); } if (_0x96096._0x98098) { _0x96096._0x98098.addEventListener('click', () => _0x125125('medium')); } if (_0x96096._0x99099) { _0x96096._0x99099.addEventListener('click', () => _0x125125('large')); } // 🚨 _0xc60c6 按鈕事件綁定 - 添加詳細日誌 if (_0x96096._0x9c09c) { _0x96096._0x9c09c.addEventListener('click', (e) => { e.stopPropagation(); _0x12d12d(); }); } // 🚨 _0x12e12e 按鈕事件綁定 - 添加詳細日誌和多種綁定方式 if (_0x96096._0xc30c3) { _0x96096._0xc30c3.addEventListener('click', (e) => { console.log('🖱️ _0xc30c3 被點擊 (addEventListener)'); e.stopPropagation(); e.preventDefault(); _0x12d12d(); }); } else { // 🚨 嘗試多種方式查找元素 const _0x12f12f = document.querySelector('#_0xc30c3'); const _0x130130 = document.querySelector('.dock-item:first-child'); const _0x131131 = document.querySelector('[id*="_0x132132"]'); if (_0x12f12f) { _0x96096._0xc30c3 = _0x12f12f; _0x96096._0xc30c3.addEventListener('click', (e) => { e.stopPropagation(); e.preventDefault(); _0x12d12d(); }); } } // 在點擊外部區域時收起的邏輯 document.addEventListener('click', (e) => { const _0x133133 = _0x96096._0xc20c2?._0x7e07e(e.target); const _0x134134 = _0x96096._0xbb0bb?._0x7e07e(e.target) || _0x96096._0xbc0bc?._0x7e07e(e.target); const _0x135135 = _0x96096._0x9d09d?._0x7e07e(e.target); const _0x136136 = _0x96096._0x9c09c?._0x7e07e(e.target) || _0x96096._0xc30c3?._0x7e07e(e.target); // 關閉設定選單 if (!_0x135135 && !_0x136136 && _0x96096._0x9d09d) { _0x96096._0x9d09d.classList.remove('visible'); } // 關閉 dock（但不在點擊切換按鈕時關閉） if (!_0x133133 && !_0x134134 && _0xed0ed) { _0xed0ed = false; localStorage.setItem(_0xec0ec, 'false'); _0xf00f0(true); _0xf10f1(); } }); if (_0x96096._0xa40a4) { _0x96096._0xa40a4.addEventListener('click', _0x128128); } // 字幕切換按鈕 if (_0x96096._0xa50a5) { _0x96096._0xa50a5.addEventListener('click', () => { _0x8a08a = !_0x8a08a; _0x137137(); _0x138138(); }); } if (_0x96096._0x9e09e) { _0x96096._0x9e09e.addEventListener('click', _0xf20f2); } if (_0x96096.helpBtn) { _0x96096.helpBtn.addEventListener('click', _0x139139); } if (_0x96096._0x9f09f) { _0x96096._0x9f09f.addEventListener('click', _0x13a13a); } if (_0x96096._0xa00a0) { _0x96096._0xa00a0.addEventListener('click', () => { if (_0x88088 > 0) { _0xeb0eb(_0x88088 - 1); } }); } if (_0x96096._0xa10a1) { _0x96096._0xa10a1.addEventListener('click', () => { if (MEMOIR_DATA && _0x88088 < MEMOIR_DATA.events.length - 1) { _0xeb0eb(_0x88088 + 1); } }); } if (_0x96096._0xa20a2) { _0x96096._0xa20a2.addEventListener('click', () => { if (_0x89089 > 0) { _0x13b13b(_0x89089 - 1); } }); } if (_0x96096._0xa30a3) { _0x96096._0xa30a3.addEventListener('click', () => { const _0xde0de = _0x13c13c(); if (_0xde0de && _0x89089 < _0xde0de.media.length - 1) { _0x13b13b(_0x89089 + 1); } }); } if (_0x96096._0xb50b5) { _0x96096._0xb50b5.addEventListener('click', _0x13d13d); } if (_0x96096._0xb80b8) { _0x96096._0xb80b8.addEventListener('click', _0x13e13e); } if (_0x96096._0xb90b9) { _0x96096._0xb90b9.addEventListener('click', (e) => { if (e.target === _0x96096._0xb90b9) { _0x13f13f(); } }); } if (_0x96096._0x9b09b) { _0x96096._0x9b09b.addEventListener('click', () => { _0x122122(); const ev = _0x13c13c(); if (ev && _0x96096._0xb20b2 && _0x8a08a) { _0x124124(); if (_0x8e08e) { _0x11c11c(ev._0x140140, _0x96096._0xb20b2); } else { _0x96096._0xb20b2.textContent = ev._0x140140 || ''; } } }); } document.addEventListener('keydown', _0x141141); _0x142142(); } window.onDecryptionSuccess = _0xd00d(_0x143143) { MEMOIR_DATA = _0x143143; _0x87087 = true; if (!window._0xb00b?.ok) { _0x29029('未通過審核，無法載入內容。'); return; } if (_0x96096._0x30030) { _0x96096._0x30030.classList.add('hidden'); } setTimeout(() => { if (typeof window._0x39039 === '_0xd00d') { window._0x39039(); // 有 MEMOIR_DATA 就會立刻啟動；沒有就不啟動 } else { _0x75075(); } }, 500); }; window.onDecryptionError = _0xd00d(_0x68068) { if (_0x96096._0x30030 && !_0x96096._0x30030.classList._0x7e07e('hidden')) { window._0x67067(_0x68068 || '密碼錯誤，請重新輸入'); } else { _0x7d07d(`解密失敗: ${_0x68068 || '未知錯誤'}`); } }; _0xd00d _0x12d12d() { if (!_0x96096._0x9d09d) { console.error('⚠ _0x9d09d 元素不存在'); return; } const menu = _0x96096._0x9d09d; if (!_0xc70c7) { _0xc80c8(); } menu.classList.add('_0xc90c9'); const _0x144144 = !menu.classList._0x7e07e('visible'); // 🔥 新增：如果要開啟設定選單，先關閉 dock if (_0x144144 && _0x96096._0xc20c2) { _0x96096._0xc20c2.classList.remove('open'); _0xed0ed = false; localStorage.setItem(_0xec0ec, 'false'); _0xf10f1(); } menu.classList.toggle('visible'); if (_0x144144 && !localStorage.getItem(_0xc50c5)) { window._0xce0ce && window._0xce0ce(); } } _0xd00d _0x129129() { if (_0x96096._0xa40a4) { if (_0x8b08b) { _0x96096._0xa40a4.classList.add('active'); } else { _0x96096._0xa40a4.classList.remove('active'); } } } _0xd00d _0x12a12a() { if (_0x8b08b) { if (_0x96096._0xa80a8) _0x96096._0xa80a8.style.display = 'none'; if (_0x96096._0xa90a9) { _0x96096._0xa90a9.style.display = 'block'; _0x96096._0xa90a9.classList.remove('hidden'); } if (_0x96096._0xa70a7) _0x96096._0xa70a7.classList.add('grid-mode'); _0x145145(); } else { if (_0x96096._0xa80a8) _0x96096._0xa80a8.style.display = 'flex'; if (_0x96096._0xa90a9) { _0x96096._0xa90a9.style.display = 'none'; _0x96096._0xa90a9.classList.add('hidden'); } if (_0x96096._0xa70a7) _0x96096._0xa70a7.classList.remove('grid-mode'); } } // 修正字幕切換 _0xd00d _0x146146() { _0x8a08a = !_0x8a08a; _0x137137(); _0x138138(); // 如果開啟字幕，重新載入當前事件描述 if (_0x8a08a) { const _0xde0de = _0x13c13c(); if (_0xde0de && _0x96096._0xb20b2) { if (_0x8e08e) { _0x11c11c(_0xde0de._0x140140 || '', _0x96096._0xb20b2); } else { _0x96096._0xb20b2.textContent = _0xde0de._0x140140 || ''; } } } } _0xd00d _0x137137() { if (_0x96096._0xa50a5) { if (_0x8a08a) { _0x96096._0xa50a5.classList.add('active'); } else { _0x96096._0xa50a5.classList.remove('active'); } } } // 修改字幕顯示控制邏輯 _0xd00d _0x138138() { if (!_0x96096._0xa60a6) return; const _0x147147 = document.getElementById('_0x148148'); if (_0x8a08a) { // 顯示字幕內容 _0x96096._0xa60a6.classList.remove('_0x140140-hidden'); _0x96096._0xa60a6.removeAttribute('data-_0x140140-hidden'); if (_0x147147) { _0x147147.style.display = 'block'; _0x147147.style.opacity = '1'; _0x147147.style._0x149149 = '200px'; } // 字幕區域本身始終可見 _0x96096._0xa60a6.style.display = 'block'; } else { // 隱藏字幕內容，但保持日期和標題可見 _0x96096._0xa60a6.classList.add('_0x140140-hidden'); _0x96096._0xa60a6.setAttribute('data-_0x140140-hidden', 'true'); if (_0x147147) { _0x147147.style.opacity = '0'; _0x147147.style._0x149149 = '0'; // 不要設置 display: none，使用 _0x149149 和 opacity 來實現平滑動畫 } // 字幕區域保持可見，只是內容部分隱藏 _0x96096._0xa60a6.style.display = 'block'; } // 添加或移除狀態類，用於 CSS 空間優化 if (_0x8a08a) { document.body.classList.remove('_0x101101-hidden'); } else { document.body.classList.add('_0x101101-hidden'); } // 重新計算媒體區域大小 optimizeMediaSpace(); } _0xd00d _0x13a13a() { _0x124124(); } _0xd00d _0xf20f2() { _0x14a14a(); if (_0x96096._0xb40b4) { _0x96096._0xb40b4.classList.add('visible'); } } _0xd00d _0x13d13d() { if (_0x96096._0xb40b4) { _0x96096._0xb40b4.classList.remove('visible'); } } _0xd00d _0x139139() { if (_0x96096._0xb70b7) { _0x96096._0xb70b7.classList.add('visible'); } } _0xd00d _0x13e13e() { if (_0x96096._0xb70b7) { _0x96096._0xb70b7.classList.remove('visible'); } } // ===== 3. 可收縮的標題功能 ===== _0xd00d _0x14b14b() { const _0x14c14c = document.querySelector('#title-_0xfe0fe'); if (!_0x14c14c) return; // 創建收縮狀態 let _0x14d14d = false; // 創建拖拉按鈕 const _0x14e14e = document.createElement('div'); _0x14e14e.innerHTML = '📖'; _0x14e14e.style.cssText = ` _0x81081: fixed; top: 10px; right: 20px; width: 40px; height: 40px; _0x82082: rgba(0,0,0,0.7); color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; cursor: pointer; z-index: 1000; _0x72072: all 0.3s ease; font-size: 18px; _0x14f14f-filter: blur(10px); `; // 切換函數 _0xd00d _0x150150() { _0x14d14d = !_0x14d14d; if (_0x14d14d) { _0x14c14c.style.cssText = ` _0xea0ea: _0x151151(-80%); _0x72072: _0xea0ea 0.3s ease; `; _0x14e14e.innerHTML = '📋'; _0x14e14e.style._0x82082 = 'rgba(59, 130, 246, 0.8)'; // 調整主內容區域 const _0xa70a7 = document.querySelector('#_0xa70a7'); if (_0xa70a7) { _0xa70a7.style._0x152152 = '60px'; _0xa70a7.style._0x72072 = 'padding-top 0.3s ease'; } } else { _0x14c14c.style.cssText = ` _0xea0ea: _0x151151(0); _0x72072: _0xea0ea 0.3s ease; `; _0x14e14e.innerHTML = '📖'; _0x14e14e.style._0x82082 = 'rgba(0,0,0,0.7)'; // 恢復主內容區域 const _0xa70a7 = document.querySelector('#_0xa70a7'); if (_0xa70a7) { _0xa70a7.style._0x152152 = ''; _0xa70a7.style._0x72072 = 'padding-top 0.3s ease'; } } } // 標題收合按鈕 if (_0x96096._0xbb0bb) { _0x96096._0xbb0bb.addEventListener('click', _0x150150); } if (_0x96096._0xbc0bc) { _0x96096._0xbc0bc.addEventListener('click', _0x150150); } _0x14e14e.onclick = _0x150150; document.body.appendChild(_0x14e14e); // 鍵盤快捷鍵 (Ctrl+H) document.addEventListener('keydown', (e) => { if (e.ctrlKey && e.key === 'h') { e.preventDefault(); _0x150150(); } }); } _0xd00d _0x153153(_0x154154, _0x155155, _0x156156 = 0) { if (!_0x96096._0xb90b9 || !_0x96096._0xba0ba) return; const _0xde0de = _0x13c13c(); const _0x157157 = _0xde0de?.media || []; // 建立圖片列表 const _0x158158 = []; _0x157157.forEach((m, i) => { const isImg = (m.type === 'image' || m._0x159159 === 'image'); if (isImg) _0x158158.push({ media: m, idx: i }); }); if (_0x158158.length === 0) return; let _0x15a15a = Math.max(0, _0x158158._0x15b15b((x) => x.idx === _0x156156)); if (_0x15a15a === -1) _0x15a15a = 0; // 渲染當前圖片 _0xd00d _0x15c15c() { _0x96096._0xba0ba.innerHTML = ''; if (_0x155155 === 'image' && _0x158158.length > 0) { const { media } = _0x158158[_0x15a15a]; // 創建圖片容器 const _0x15d15d = document.createElement('div'); _0x15d15d.style.cssText = ` _0x81081: _0x15e15e; width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; `; const img = document.createElement('img'); const imgSrc = _0x15f15f(media); // *** 關鍵修正：處理MSE解密的圖片 *** if (imgSrc && imgSrc._0x160160('media/')) { img.setAttribute('data-needs-mse-decrypt', 'true'); img.setAttribute('data-original-src', imgSrc); // 設定載入動畫 img.src = 'data:image/svg+xml;base64,_0x161161+_0x162162+_0x163163='; // 觸發解密 if (window._0x164164) { setTimeout(() => { window._0x164164(img, false); }, 100); } } else { img.src = imgSrc; } img.alt = '全螢幕圖片'; img.style.cssText = ` max-width: 90vw; max-height: 90vh; object-fit: contain; cursor: pointer; border-radius: 8px; box-shadow: 0 10px 30px rgba(0,0,0,0.3); `; _0x15d15d.appendChild(img); // *** 新增：左右導航按鈕 *** if (_0x158158.length > 1) { // 左按鈕 const leftBtn = document.createElement('button'); leftBtn.innerHTML = '‹'; leftBtn.style.cssText = ` _0x81081: _0x113113; left: 20px; top: 50%; _0xea0ea: _0x151151(-50%); _0x82082: rgba(0,0,0,0.6); color: white; border: none; width: 50px; height: 50px; border-radius: 50%; font-size: 24px; cursor: pointer; z-index: 1001; _0x72072: all 0.2s ease; display: ${_0x15a15a > 0 ? 'block' : 'none'}; `; leftBtn.onmouseover = () => leftBtn.style._0x82082 = 'rgba(0,0,0,0.8)'; leftBtn.onmouseout = () => leftBtn.style._0x82082 = 'rgba(0,0,0,0.6)'; leftBtn.onclick = (e) => { e.stopPropagation(); if (_0x15a15a > 0) { _0x15a15a--; _0x15c15c(); _0x13b13b(_0x158158[_0x15a15a].idx); } }; // 右按鈕 const _0x165165 = document.createElement('button'); _0x165165.innerHTML = '›'; _0x165165.style.cssText = ` _0x81081: _0x113113; right: 20px; top: 50%; _0xea0ea: _0x151151(-50%); _0x82082: rgba(0,0,0,0.6); color: white; border: none; width: 50px; height: 50px; border-radius: 50%; font-size: 24px; cursor: pointer; z-index: 1001; _0x72072: all 0.2s ease; display: ${_0x15a15a < _0x158158.length - 1 ? 'block' : 'none'}; `; _0x165165.onmouseover = () => _0x165165.style._0x82082 = 'rgba(0,0,0,0.8)'; _0x165165.onmouseout = () => _0x165165.style._0x82082 = 'rgba(0,0,0,0.6)'; _0x165165.onclick = (e) => { e.stopPropagation(); if (_0x15a15a < _0x158158.length - 1) { _0x15a15a++; _0x15c15c(); _0x13b13b(_0x158158[_0x15a15a].idx); } }; _0x15d15d.appendChild(leftBtn); _0x15d15d.appendChild(_0x165165); } // *** 新增：關閉按鈕 *** const _0xcb0cb = document.createElement('button'); _0xcb0cb.innerHTML = '×'; _0xcb0cb.style.cssText = ` _0x81081: _0x113113; top: 20px; right: 20px; _0x82082: rgba(0,0,0,0.6); color: white; border: none; width: 40px; height: 40px; border-radius: 50%; font-size: 24px; cursor: pointer; z-index: 1001; _0x72072: all 0.2s ease; `; _0xcb0cb.onmouseover = () => _0xcb0cb.style._0x82082 = 'rgba(0,0,0,0.8)'; _0xcb0cb.onmouseout = () => _0xcb0cb.style._0x82082 = 'rgba(0,0,0,0.6)'; _0xcb0cb.onclick = (e) => { e.stopPropagation(); _0x13f13f(); }; _0x15d15d.appendChild(_0xcb0cb); _0x96096._0xba0ba.appendChild(_0x15d15d); } } // *** 修正：點擊背景關閉燈箱 *** _0x96096._0xb90b9.onclick = () => _0x13f13f(); _0x96096._0xba0ba.onclick = (e) => e.stopPropagation(); // 鍵盤事件處理 _0xd00d onKeyDown(e) { if (_0x155155 !== 'image' || _0x158158.length <= 1) return; if (e.key === '_0x166166' && _0x15a15a < _0x158158.length - 1) { _0x15a15a++; _0x15c15c(); _0x13b13b(_0x158158[_0x15a15a].idx); } else if (e.key === '_0x167167' && _0x15a15a > 0) { _0x15a15a--; _0x15c15c(); _0x13b13b(_0x158158[_0x15a15a].idx); } else if (e.key === 'Escape') { _0x13f13f(); } } document.addEventListener('keydown', onKeyDown); // 顯示燈箱 _0x96096._0xb90b9.classList.add('visible'); _0x15c15c(); // 清理函數 const originalHide = _0x13f13f; _0x13f13f = _0xd00d() { document.removeEventListener('keydown', onKeyDown); _0x96096._0xb90b9.classList.remove('visible'); _0x13f13f = originalHide; }; } _0xd00d _0x13f13f() { if (_0x96096._0xb90b9) { _0x96096._0xb90b9.classList.remove('visible'); } } _0xd00d _0x13c13c() { if (!MEMOIR_DATA || !MEMOIR_DATA.events) return null; const _0xdb0db = _0xdc0dc(); return _0xdb0db[_0x88088] || null; } _0xd00d _0xdc0dc() { if (!MEMOIR_DATA || !MEMOIR_DATA.events) return []; return [...MEMOIR_DATA.events].sort((a, b) => new Date(a.date).getTime() - new Date(b.date).getTime() ); } _0xd00d _0xeb0eb(_0x168168) { if (!MEMOIR_DATA || !MEMOIR_DATA.events) return; const _0xdb0db = _0xdc0dc(); if (_0x168168 < 0 || _0x168168 >= _0xdb0db.length || _0x168168 === _0x88088) return; if (_0x96096._0xa60a6) _0x96096._0xa60a6.classList.add('_0x169169'); if (_0x96096._0xa70a7) _0x96096._0xa70a7.classList.add('_0x169169'); _0x91091 = true; _0x124124(); setTimeout(() => { _0x88088 = _0x168168; _0x89089 = 0; _0x16a16a(); _0xda0da(); setTimeout(() => { if (_0x96096._0xa60a6) _0x96096._0xa60a6.classList.remove('_0x169169'); if (_0x96096._0xa70a7) _0x96096._0xa70a7.classList.remove('_0x169169'); _0x91091 = false; }, 300); }, 150); } _0xd00d _0x13b13b(_0x16b16b) { const _0xde0de = _0x13c13c(); if (!_0xde0de || !_0xde0de.media) return; if (_0x16b16b < 0 || _0x16b16b >= _0xde0de.media.length || _0x16b16b === _0x89089) return; _0x89089 = _0x16b16b; _0x104104(); _0x16c16c(); _0x16d16d(); if (_0x8b08b) { _0x145145(); } } _0xd00d _0x16a16a() { const _0xde0de = _0x13c13c(); if (!_0xde0de) { return; } // 更新事件信息 _0x16e16e(_0xde0de); // 更新導航按鈕 _0x16f16f(); // 更新進度指示器 _0xda0da(); // 顯示媒體 _0x104104(); // 更新媒體導航 _0x16c16c(); // 渲染縮圖 _0x16d16d(); // 如果是網格模式，渲染網格視圖 if (_0x8b08b) { _0x145145(); } } _0xd00d _0x16e16e(event) { if (!event) return; // 確保元素存在並更新 if (_0x96096._0xad0ad) { _0x96096._0xad0ad.textContent = _0x88088 + 1; } if (_0x96096._0xae0ae) { _0x96096._0xae0ae.textContent = _0xdc0dc().length; } // 更新媒體計數 if (_0x96096._0xaf0af) { const _0x170170 = event.media ? event.media.length : 0; _0x96096._0xaf0af.textContent = _0x170170; } // 更新事件日期 if (_0x96096._0xb00b0) { try { const _0xb00b0 = new Date(event.date)._0xdf0df('zh-TW', { year: 'numeric', month: 'long', day: 'numeric' }); _0x96096._0xb00b0.textContent = _0xb00b0; _0x96096._0xb00b0.style.display = 'block'; } catch (e) { _0x96096._0xb00b0.textContent = event.date; _0x96096._0xb00b0.style.display = 'block'; } } // 更新事件標題 if (_0x96096._0xb10b1) { _0x96096._0xb10b1.textContent = event.title || ''; _0x96096._0xb10b1.style.display = 'block'; // 應用跑馬燈效果 setTimeout(() => { _0x10c10c(_0x96096._0xb10b1); }, 100); } // 更新事件描述 if (_0x96096._0xb20b2 && _0x8a08a) { _0x96096._0xb20b2.style.display = 'block'; if (_0x8e08e) { _0x11c11c(event._0x140140 || '', _0x96096._0xb20b2); } else { _0x96096._0xb20b2.textContent = event._0x140140 || ''; } } // 確保字幕區域可見 if (_0x96096._0xa60a6) { _0x96096._0xa60a6.style.display = 'block'; _0x96096._0xa60a6.style.opacity = '1'; _0x96096._0xa60a6.style._0xd90d9 = 'visible'; } } // 新增媒體位置指示器更新函數 _0xd00d _0x171171() { const _0xde0de = _0x13c13c(); if (!_0xde0de || !_0xde0de.media) return; // 更新媒體計數顯示 (修正 1/1 問題) const _0x172172 = document.querySelector('.media-count'); if (_0x172172) { _0x172172.textContent = `${_0x89089 + 1}/${_0xde0de.media.length}`; } } _0xd00d _0x16f16f() { const _0xae0ae = _0xdc0dc().length; if (_0x96096._0xa00a0) { if (_0x88088 === 0) { _0x96096._0xa00a0.classList.add('_0x44044'); } else { _0x96096._0xa00a0.classList.remove('_0x44044'); } } if (_0x96096._0xa10a1) { if (_0x88088 === _0xae0ae - 1) { _0x96096._0xa10a1.classList.add('_0x44044'); } else { _0x96096._0xa10a1.classList.remove('_0x44044'); } } } _0xd00d _0x104104() { const _0xde0de = _0x13c13c(); if (!_0xde0de || !_0xde0de.media || _0xde0de.media.length === 0) { _0x173173(); return; } const media = _0xde0de.media[_0x89089]; if (!media) { _0x173173(); return; } if (_0x96096._0xaa0aa) { _0x96096._0xaa0aa.innerHTML = ''; try { let _0x174174; if (media.type === 'image' || media._0x159159 === 'image') { _0x174174 = document.createElement('img'); // 確保圖片正確縮放 _0x174174.style.cssText = ` max-width: 100%; max-height: 100%; width: auto; height: auto; object-fit: contain; object-_0x81081: center; cursor: pointer; border-radius: 4px; display: block; margin: 0 auto; `; _0x174174.alt = '回憶錄圖片'; _0x174174.onclick = () => { _0x153153(null, 'image', _0x89089); }; // MSE解密支持 const _0x175175 = _0x15f15f(media); if (_0x175175 && _0x175175._0x160160('media/')) { _0x174174.setAttribute('data-needs-mse-decrypt', 'true'); _0x174174.setAttribute('data-original-src', _0x175175); // 設定載入中的佔位圖 _0x174174.src = 'data:image/svg+xml;base64,_0x161161+_0x162162+_0x163163='; if (window._0x176176) { setTimeout(() => { window._0x176176(); }, 100); } } else { _0x174174.src = _0x175175; _0x174174.onerror = () => { _0x177177('圖片載入失敗'); }; } } else if (media.type === 'video' || media._0x159159 === 'video') { if (media.isUrl && (media.url?._0x160160('youtube.com') || media.url?._0x160160('youtu.be'))) { const videoId = _0x178178(media.url); if (videoId) { const _0x179179 = document.createElement('div'); _0x179179._0xe20e2 = 'youtube-_0xfe0fe'; _0x179179.style.cssText = ` _0x81081: _0x15e15e; width: 100%; height: 0; padding-bottom: 56.25%; overflow: hidden; border-radius: 8px; `; const iframe = document.createElement('iframe'); iframe.src = `https://www.youtube-_0x17a17a.com/embed/${videoId}?rel=0&_0x17b17b=1`; iframe.setAttribute('_0x17c17c', ''); iframe.setAttribute('allow', '_0x17d17d; _0x17e17e; _0x17f17f-write; _0x180180-media; _0x181181; picture-in-picture'); iframe.style.cssText = ` _0x81081: _0x113113; top: 0; left: 0; width: 100%; height: 100%; border: none; `; _0x179179.appendChild(iframe); _0x96096._0xaa0aa.appendChild(_0x179179); return; } } else { _0x174174 = document.createElement('video'); _0x174174.style.cssText = ` max-width: 100%; max-height: 100%; width: auto; height: auto; object-fit: contain; object-_0x81081: center; cursor: pointer; `; _0x174174._0x182182 = true; _0x174174.muted = true; _0x174174._0x183183 = true; _0x174174.onclick = () => { _0x153153(_0x15f15f(media), 'video'); }; const _0x184184 = _0x15f15f(media); if (_0x184184 && _0x184184._0x160160('media/')) { _0x174174.setAttribute('data-needs-mse-decrypt', 'true'); _0x174174.setAttribute('data-original-src', _0x184184); if (window._0x176176) { setTimeout(() => { window._0x176176(); }, 100); } } else { _0x174174.src = _0x184184; } } } if (_0x174174) { _0x96096._0xaa0aa.appendChild(_0x174174); } // 更新媒體計數器 _0x185185(); } catch (error) { _0x177177(`媒體顯示錯誤: ${error.message}`); } } } // 修正媒體計數器更新 _0xd00d _0x185185() { const _0xde0de = _0x13c13c(); if (!_0xde0de || !_0xde0de.media) return; if (_0x96096._0xb30b3) { const _0x186186 = _0x89089 + 1; const _0xdd0dd = _0xde0de.media.length; _0x96096._0xb30b3.textContent = `${_0x186186} / ${_0xdd0dd}`; _0x96096._0xb30b3.style.display = _0xdd0dd > 1 ? 'block' : 'none'; } } _0xd00d _0x15f15f(media) { if (media.isUrl || media.is_url) { return media.url || media.path; } else { let _0x187187 = media.path; if (!_0x187187._0x188188('./') && !_0x187187._0x188188('http')) { if (_0x187187._0x188188('media/')) { _0x187187 = './' + _0x187187; } else { // _0x187187 = './media/' + (_0x187187.split('/').pop() || _0x187187); _0x187187 = `./media/${media._0x189189}`; } } return _0x187187; } } _0xd00d _0x178178(url) { const regExp = /^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|&v=)([^#&?]*).*/; const match = url.match(regExp); return (match && match[2].length === 11) ? match[2] : null; } _0xd00d _0x177177(message) { if (_0x96096._0xaa0aa) { _0x96096._0xaa0aa.innerHTML = ` <div style="text-align: center; color: #ef4444; padding: 40px;"> <div style=atob('Zm9udC1zaXplOiA0OHB4OyBtYXJnaW4tYm90dG9tOiAyMHB4Ow==')>❌</div> <div style="font-size: 16px;atob('PiR7bWVzc2FnZX08L2Rpdj4gPC9kaXY+IGA7IH0gfSBfMHhkMDBkIF8weDE3MzE3MygpIHsgaWYgKF8weDk2MDk2Ll8weGFhMGFhKSB7IGNvbnN0IGljb24gPSBfMHg4NjA4NiA/ICfwn5SSJyA6ICfwn5O3JzsgXzB4OTYwOTYuXzB4YWEwYWEuaW5uZXJIVE1MID0gYCA8ZGl2IHN0eWxlPQ==')text-align: center; color: #9ca3af; padding: 40px;"> <div style=atob('Zm9udC1zaXplOiA0OHB4OyBtYXJnaW4tYm90dG9tOiAyMHB4Ow==')>${icon}</div> <div style="font-size: 16px;">此時間節點沒有媒體內容</div> </div> `; } } _0xd00d _0x16c16c() { const _0xde0de = _0x13c13c(); if (!_0xde0de || !_0xde0de.media) return; const _0x170170 = _0xde0de.media.length; // 更新導航按鈕狀態 if (_0x96096._0xa20a2) { if (_0x89089 === 0) { _0x96096._0xa20a2.classList.add('_0x44044'); _0x96096._0xa20a2._0x44044 = true; } else { _0x96096._0xa20a2.classList.remove('_0x44044'); _0x96096._0xa20a2._0x44044 = false; } } if (_0x96096._0xa30a3) { if (_0x89089 === _0x170170 - 1) { _0x96096._0xa30a3.classList.add('_0x44044'); _0x96096._0xa30a3._0x44044 = true; } else { _0x96096._0xa30a3.classList.remove('_0x44044'); _0x96096._0xa30a3._0x44044 = false; } } // 更新媒體計數器 _0x185185(); } _0xd00d _0x18a18a() { const _0xde0de = _0x13c13c(); if (!_0xde0de || !_0xde0de.media) return; const _0xac0ac = document.getElementById('media-grid') || _0x96096._0xaa0aa; if (!_0xac0ac) return; _0xac0ac.innerHTML = ''; _0xac0ac._0xe20e2 = 'media-grid'; _0xac0ac.style.display = 'grid'; _0xac0ac.style._0x18b18b = 'repeat(auto-fill, minmax(200px, 1fr))'; _0xac0ac.style.gap = '16px'; _0xac0ac.style.padding = '16px'; _0xde0de.media.forEach((media, index) => { const _0x18c18c = document.createElement('div'); _0x18c18c._0xe20e2 = 'grid-item'; _0x18c18c.style.cursor = 'pointer'; _0x18c18c.style._0x18d18d = '8px'; _0x18c18c.style.overflow = 'hidden'; _0x18c18c.style._0x18e18e = '1'; _0x18c18c.style._0x18f18f = '#f5f5f5'; if (media.type === 'image' || media._0x159159 === 'image') { const img = document.createElement('img'); img.style.width = '100%'; img.style.height = '100%'; img.style.objectFit = 'cover'; img.alt = `圖片 ${index + 1}`; const _0x175175 = _0x15f15f(media); if (_0x175175 && _0x175175._0x160160('media/')) { img.setAttribute('data-needs-mse-decrypt', 'true'); img.setAttribute('data-original-src', _0x175175); img.src = 'data:image/svg+xml;base64,_0x190190+PGRlZnM+_0x191191+_0x192192+PC9zdmc+'; } else { img.src = _0x175175; } _0x18c18c.appendChild(img); } else { // 影片圖示 const _0x193193 = document.createElement('div'); _0x193193.innerHTML = '🎥'; _0x193193.style.width = '100%'; _0x193193.style.height = '100%'; _0x193193.style.display = 'flex'; _0x193193.style._0x194194 = 'center'; _0x193193.style._0x195195 = 'center'; _0x193193.style._0x90090 = '48px'; _0x18c18c.appendChild(_0x193193); } _0x18c18c.onclick = () => { _0x89089 = index; _0x104104(); // 可能需要切換回單一顯示模式 }; _0xac0ac.appendChild(_0x18c18c); }); // 觸發網格圖片解密 if (window._0x196196) { setTimeout(() => { window._0x196196(); }, 200); } } // ===== 4. 修復媒體選擇器carousel ===== _0xd00d _0x16d16d() { if (!_0x96096._0xab0ab) { // 如果沒有 _0xab0ab，嘗試查找其他縮圖容器 const _0x197197 = _0x96096._0x198198 || document.querySelector('._0x199199-scroll') || document.querySelector('.media-_0x199199'); if (!_0x197197) return; // 創建縮圖容器結構 if (!_0x96096._0xab0ab) { _0x96096._0xab0ab = _0x197197; } } const _0xde0de = _0x13c13c(); if (!_0xde0de || !_0xde0de.media) { _0x96096._0xab0ab.innerHTML = ''; return; } _0x96096._0xab0ab.innerHTML = ''; _0xde0de.media.forEach((media, index) => { const _0x19a19a = document.createElement('div'); _0x19a19a._0xe20e2 = `_0x19b19b-item ${index === _0x89089 ? 'active' : ''}`; _0x19a19a.style.cssText = ` _0x81081: _0x15e15e; width: 60px; height: 60px; margin: 0 4px; border-radius: 8px; overflow: hidden; cursor: pointer; border: 2px solid ${index === _0x89089 ? '#3b82f6' : '_0x19c19c'}; _0x72072: all 0.2s ease; flex-shrink: 0; _0x82082: rgba(255, 255, 255, 0.1); `; _0x19a19a.onmouseover = () => { if (index !== _0x89089) { _0x19a19a.style.border = '2px solid rgba(59, 130, 246, 0.5)'; } }; _0x19a19a.onmouseout = () => { if (index !== _0x89089) { _0x19a19a.style.border = '2px solid _0x19c19c'; } }; _0x19a19a.onclick = () => _0x13b13b(index); const _0x19d19d = document.createElement('img'); _0x19d19d._0xe20e2 = '_0x19b19b-image'; _0x19d19d.style.cssText = ` width: 100%; height: 100%; object-fit: cover; object-_0x81081: center; `; _0x19d19d.alt = `縮圖 ${index + 1}`; if ((media.type === 'video' || media._0x159159 === 'video') && media.isUrl && (media.url?._0x160160('youtube.com') || media.url?._0x160160('youtu.be'))) { const videoId = _0x178178(media.url); if (videoId) { _0x19d19d.src = `https://img.youtube.com/vi/${videoId}/_0x19e19e.jpg`; _0x19d19d.onerror = () => { _0x19d19d.src = 'data:image/svg+xml;base64,_0x19f19f+_0x1a01a0+_0x1a11a1+_0x1a21a2='; }; } } else { const _0x175175 = _0x15f15f(media); if (_0x175175 && _0x175175._0x160160('media/')) { _0x19d19d.setAttribute('data-needs-mse-decrypt', 'true'); _0x19d19d.setAttribute('data-original-src', _0x175175); _0x19d19d.src = 'data:image/svg+xml;base64,_0x1a31a3+_0x1a41a4+_0x192192+PC9zdmc+'; } else { _0x19d19d.src = _0x175175; _0x19d19d.onerror = () => { _0x19d19d.src = 'data:image/svg+xml;base64,_0x1a51a5+_0x1a61a6+_0x1a21a2='; }; } } _0x19a19a.appendChild(_0x19d19d); // 影片播放圖示 if (media.type === 'video' || media._0x159159 === 'video') { const _0x1a71a7 = document.createElement('div'); _0x1a71a7.innerHTML = '▶'; _0x1a71a7.style.cssText = ` _0x81081: _0x113113; top: 50%; left: 50%; _0xea0ea: _0x1a81a8(-50%, -50%); color: white; font-size: 16px; text-shadow: 0 0 4px rgba(0,0,0,0.8); pointer-events: none; `; _0x19a19a.appendChild(_0x1a71a7); } _0x96096._0xab0ab.appendChild(_0x19a19a); }); // 觸發縮圖解密 if (window._0x196196) { setTimeout(() => { window._0x196196(); }, 200); } } // ===== 初始化所有改進功能 ===== _0xd00d _0x1a91a9() { // 等待DOM載入完成 if (document._0x47047 === 'loading') { document.addEventListener('_0x48048', () => { setTimeout(() => { _0x14b14b(); // 確保媒體計數顯示正確 if (_0x13c13c()) { _0x16e16e(_0x13c13c()); } }, 1000); }); } else { setTimeout(() => { _0x14b14b(); if (_0x13c13c()) { _0x16e16e(_0x13c13c()); } }, 1000); } } _0xd00d _0x145145() { if (!_0x96096._0xa90a9) return; const _0xde0de = _0x13c13c(); if (!_0xde0de || !_0xde0de.media) { _0x96096._0xa90a9.innerHTML = ''; return; } _0x96096._0xa90a9.innerHTML = ''; _0xde0de.media.forEach((media, index) => { const _0x18c18c = document.createElement('div'); _0x18c18c._0xe20e2 = `grid-item ${index === _0x89089 ? 'active' : ''}`; _0x18c18c.onclick = () => _0x13b13b(index); const _0x1aa1aa = document.createElement('div'); _0x1aa1aa._0xe20e2 = 'grid-item-content'; if ((media.type === 'video' || media._0x159159 === 'video') && media.isUrl && (media.url?._0x160160('youtube.com') || media.url?._0x160160('youtu.be'))) { const videoId = _0x178178(media.url); if (videoId) { const _0x174174 = document.createElement('img'); _0x174174.src = `https://img.youtube.com/vi/${videoId}/_0x19e19e.jpg`; _0x174174.alt = `YouTube影片 ${index + 1}`; _0x174174.onerror = () => { _0x174174.src = `https://img.youtube.com/vi/${videoId}/_0x1ab1ab.jpg`; }; _0x1aa1aa.appendChild(_0x174174); } } else { const _0x174174 = document.createElement('img'); // *** 修正：使用通用描述 *** _0x174174.alt = `媒體 ${index + 1}`; const _0x175175 = _0x15f15f(media); // *** 關鍵修正：為網格圖片加入MSE解密支援 *** if (_0x175175 && _0x175175._0x160160('media/')) { _0x174174.setAttribute('data-needs-mse-decrypt', 'true'); _0x174174.setAttribute('data-original-src', _0x175175); // 網格載入動畫 _0x174174.src = 'data:image/svg+xml;base64,_0x190190+PGRlZnM+_0x1ac1ac+_0x192192+PC9zdmc+'; } else { _0x174174.src = _0x175175; _0x174174.onerror = () => { _0x174174.src = 'data:image/svg+xml;base64,_0x190190+_0x1ad1ad+_0x1ae1ae='; }; } _0x1aa1aa.appendChild(_0x174174); } _0x18c18c.appendChild(_0x1aa1aa); _0x96096._0xa90a9.appendChild(_0x18c18c); }); // *** 觸發網格解密 *** if (window._0x196196) { setTimeout(() => { window._0x196196(); }, 200); } } _0xd00d _0x14a14a() { if (!MEMOIR_DATA || !_0x96096._0xb60b6) return; const _0xdb0db = _0xdc0dc(); _0x96096._0xb60b6.innerHTML = '<div class="_0x1af1af-line"></div>'; _0xdb0db.forEach((event, index) => { const item = document.createElement('div'); item._0xe20e2 = `_0x1af1af-item ${index === _0x88088 ? 'active' : ''}`; const node = document.createElement('div'); node._0xe20e2 = '_0x1af1af-node'; const wrapper = document.createElement('div'); wrapper._0xe20e2 = '_0x1af1af-event'; const content = document.createElement('div'); content._0xe20e2 = '_0x1af1af-event-content'; const header = document.createElement('div'); header._0xe20e2 = '_0x1af1af-event-header'; const dateEl = document.createElement('div'); dateEl._0xe20e2 = '_0x1af1af-event-date'; dateEl.textContent = new Date(event.date)._0xdf0df('zh-TW'); const titleEl = document.createElement('div'); titleEl._0xe20e2 = '_0x1af1af-event-title'; titleEl.textContent = event.title; const descEl = document.createElement('div'); descEl._0xe20e2 = '_0x1af1af-event-_0x140140'; descEl.textContent = event._0x140140; header.append(dateEl, titleEl); content.append(header, descEl); wrapper.appendChild(content); item.append(node, wrapper); item.onclick = () => { _0xeb0eb(index); _0x13d13d(); }; _0x96096._0xb60b6.appendChild(item); }); if (typeof lucide !== 'undefined') lucide._0x66066(); } _0xd00d _0x141141(e) { if (_0x96096._0xb40b4?.classList._0x7e07e('visible') || _0x96096._0xb70b7?.classList._0x7e07e('visible') || _0x96096._0xb90b9?.classList._0x7e07e('visible')) { if (e.key === 'Escape') { e.preventDefault(); _0x13d13d(); _0x13e13e(); _0x13f13f(); } return; } if (!(_0x96096._0xb40b4?.classList._0x7e07e('visible') || _0x96096._0xb70b7?.classList._0x7e07e('visible') || _0x96096._0xb90b9?.classList._0x7e07e('visible'))) { const _0x1b01b0 = (e.ctrlKey || e.metaKey); if (_0x1b01b0 && (e.key === '+' || e.key === '=')) { e.preventDefault(); _0x125125(_0x90090 === 'small' ? 'medium' : 'large'); return; } if (_0x1b01b0 && e.key === '-') { e.preventDefault(); _0x125125(_0x90090 === 'large' ? 'medium' : 'small'); return; } if (_0x1b01b0 && e.key === '0') { e.preventDefault(); _0x125125('medium'); return; } } switch (e.key) { case '_0x167167': e.preventDefault(); if (_0x88088 > 0) { _0xeb0eb(_0x88088 - 1); } break; case '_0x166166': e.preventDefault(); if (MEMOIR_DATA && _0x88088 < _0xdc0dc().length - 1) { _0xeb0eb(_0x88088 + 1); } break; case 'Home': e.preventDefault(); if (MEMOIR_DATA && MEMOIR_DATA.events) { _0xeb0eb(0); } break; case 'End': e.preventDefault(); if (MEMOIR_DATA && MEMOIR_DATA.events) { _0xeb0eb(_0xdc0dc().length - 1); } break; case 'g': case 'G': e.preventDefault(); _0x128128(); break; case 't': case 'T': e.preventDefault(); _0xf20f2(); break; case 'h': case 'H': case '?': e.preventDefault(); _0x139139(); break; case 'Escape': e.preventDefault(); if (_0x8b08b) { _0x128128(); } break; case ' ': e.preventDefault(); const video = _0x96096._0xaa0aa?.querySelector('video'); if (video) { if (video.paused) { video.play(); } else { video.pause(); } } break; } } _0xd00d _0x142142() { let _0x1b11b1 = 0; let _0x1b21b2 = 0; const _0x1b31b3 = 50; const _0x1b41b4 = _0x96096._0xa60a6 || document.body; _0x1b41b4.addEventListener('_0x1b51b5', (e) => { _0x1b11b1 = e.touches[0].clientX; }, { passive: true }); _0x1b41b4.addEventListener('_0x1b61b6', (e) => { _0x1b21b2 = e._0x1b71b7[0].clientX; const deltaX = _0x1b21b2 - _0x1b11b1; if (Math.abs(deltaX) > _0x1b31b3) { if (deltaX > 0 && _0x88088 > 0) { _0xeb0eb(_0x88088 - 1); } else if (deltaX < 0 && MEMOIR_DATA && _0x88088 < _0xdc0dc().length - 1) { _0xeb0eb(_0x88088 + 1); } } }, { passive: true }); } _0xd00d _0x75075() { try { if (window._0x1b81b8) { console.log('應用已初始化，跳過重複執行'); return; } window._0x1b81b8 = true; if (!MEMOIR_DATA) { if (window.MEMOIR_DATA) { MEMOIR_DATA = window.MEMOIR_DATA; } else { if (typeof window._0x39039 === '_0xd00d') { setTimeout(() => window._0x39039(), 500); } return; } } // 重新獲取可能缺失的元素 if (!_0x96096._0xab0ab) { _0x96096._0xab0ab = document.getElementById('_0xab0ab') || document.querySelector('._0x199199-scroll') || _0x96096._0x198198; } if (!_0x96096._0xa60a6) { _0x96096._0xa60a6 = document.getElementById('_0xa60a6'); } if (!_0x96096._0xb00b0) { _0x96096._0xb00b0 = document.getElementById('_0xb00b0'); } if (!_0x96096._0xb10b1) { _0x96096._0xb10b1 = document.getElementById('_0xb10b1'); } if (!_0x96096._0xb20b2) { _0x96096._0xb20b2 = document.getElementById('_0xb20b2'); } if (!_0x96096._0xb30b3) { _0x96096._0xb30b3 = document.getElementById('_0xb30b3'); } // 顯示主應用程式 if (_0x96096.app) _0x96096.app.classList.remove('hidden'); // 初始化 UI _0x12c12c(); _0x129129(); _0x137137(); _0x138138(); _0x123123(); _0x127127(); _0x126126(); // 添加媒體互動追蹤 if (_0x96096._0xaa0aa) { _0x96096._0xaa0aa.addEventListener('click', () => { window.dispatchEvent(new _0x1b91b9('memoir:_0x51051', { detail: { _0x168168: _0x88088, _0x16b16b: _0x89089 } })); }); } // 事件切換追蹤 const originalGoToEvent = _0xeb0eb; _0xeb0eb = _0xd00d(index) { originalGoToEvent(index); // 發送事件切換追蹤 if (window._0xe00e) { window._0xe00e('_0x1ba1ba'); } }; // 跑馬燈：回憶錄名稱（桌機 + 手機） const _0x1bb1bb = document.querySelector('.title-text'); const _0x1bc1bc = document.querySelector('.mobile-title'); _0x10c10c(_0x1bb1bb); _0x10c10c(_0x1bc1bc); // 載入第一個事件 if (MEMOIR_DATA.events && MEMOIR_DATA.events.length > 0) { _0x16a16a(); // 初始化進度指示器 _0xda0da(); } else { _0x1bd1bd(); } // 隱藏載入畫面 setTimeout(() => { if (_0x96096._0x2f02f) { _0x96096._0x2f02f.classList.add('hidden'); } }, 1000); (_0xd00d _0x1be1be(){ const _0x1bf1bf = document.querySelector('meta[name="memoir-idatob('XScpPy5jb250ZW50IHx8ICcnOyBjb25zdCBiYWNrZW5kID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignbWV0YVtuYW1lPQ==')backend-urlatob('XScpPy5jb250ZW50IHx8ICcnOyBjb25zdCBwYXlsb2FkID0geyBfMHgxMjAxMjogXzB4MWJmMWJmLCBfMHgxNzAxNzogbG9jYXRpb24uXzB4MTgwMTgsIF8weDE5MDE5OiBsb2NhdGlvbi5vcmlnaW4gKyBsb2NhdGlvbi5fMHgxODAxOC5zcGxpdCgnLycpLnNsaWNlKDAsMykuam9pbignLycpLCBfMHgyMDAyMDogd2luZG93Ll8weGIwMGI/LnRva2VuIHx8IG51bGwsIC8vIOKGkCDkuIDotbfluLbkuIrvvIzmlrnkvr/pl5zoga8gfTsgaWYgKGJhY2tlbmQpIHsgZmV0Y2goYCR7YmFja2VuZH0vYXBpL2FkbWluL3RyYWNrL3ZpZXdgLCB7IG1ldGhvZDogJ1BPU1QnLCBoZWFkZXJzOiB7J0NvbnRlbnQtVHlwZSc6J18weDIyMDIyL2pzb24nfSwgYm9keTogSlNPTi5fMHgyMzAyMyhwYXlsb2FkKSB9KS5jYXRjaCgoKT0+e30pOyB9IH0pKCk7IC8vIOWIneWni+WMluepuumWk+WEquWMliBzZXRUaW1lb3V0KCgpID0+IHsgb3B0aW1pemVNZWRpYVNwYWNlKCk7IH0sIDIwMCk7IC8vIOioree9ruWIneWni+eLgOaFi+mhniBpZiAoXzB4ZjYwZjYpIHsgZG9jdW1lbnQuYm9keS5jbGFzc0xpc3QuYWRkKCdoZWFkZXItXzB4ZjQwZjQnKTsgfSBpZiAoIV8weDhhMDhhKSB7IGRvY3VtZW50LmJvZHkuY2xhc3NMaXN0LmFkZCgnXzB4MTAxMTAxLWhpZGRlbicpOyB9IH0gY2F0Y2ggKGVycm9yKSB7IF8weDdkMDdkKGDmh4nnlKjnqIvlvI/liJ3lp4vljJblpLHmlZc6ICR7ZXJyb3IubWVzc2FnZX1gKTsgfSB9IF8weGQwMGQgXzB4MWJkMWJkKCkgeyBpZiAoXzB4OTYwOTYuXzB4YWEwYWEpIHsgY29uc3Qgc3RhdHVzID0gXzB4ODYwODYgPyAn5Yqg5a+G5Zue5oa26YyE5bey6LyJ5YWlJyA6ICflm57mhrbpjITlt7LovInlhaUnOyBfMHg5NjA5Ni5fMHhhYTBhYS5pbm5lckhUTUwgPSBgIDxkaXYgc3R5bGU9')text-align: center; color: #9ca3af; padding: 40px;"> <div style=atob('Zm9udC1zaXplOiAxOHB4OyBtYXJnaW4tYm90dG9tOiAxMHB4Ow==')>${status}</div> <div style="font-size: 14px;atob('PuS9huaaq+aZguaykuacieaZgumWk+evgOm7nuWFp+WuuTwvZGl2PiA8L2Rpdj4gYDsgfSB9IGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ18weDQ4MDQ4JywgXzB4ZDAwZCAoKSB7IF8weDEwNzEwNygn5q2j5Zyo5rqW5YKZ5Yqg5a+G57O757WxLi4uJyk7IGlmICh0eXBlb2YgbHVjaWRlICE9PSAndW5kZWZpbmVkJykgeyB0cnkgeyBsdWNpZGUuXzB4NjYwNjYoKTsgfSBjYXRjaCAoZSkgeyBjb25zb2xlLndhcm4oZSk7IH0gfSBjb25zdCBnZXRNb2RlID0gKCkgPT4gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignbWV0YVtuYW1lPQ==')_0x77077-mode"]')?.content || 'static'; _0xd00d _0x78078() { if (window.MEMOIR_DATA?.events) return true; const el = document.getElementById('_0x79079-memoir-data'); if (!el) return false; try { const txt = el.textContent || ''; window.MEMOIR_DATA = JSON.parse(txt); return !!window.MEMOIR_DATA?.events; } catch (e) { console.warn(e); return false; } } _0xd00d _0x7a07a() { const ready = _0x78078() || !!(window.MEMOIR_DATA && window.MEMOIR_DATA.events); if (ready) { if (typeof _0x75075 === '_0xd00d') _0x75075(); return true; } return false; } window._0x39039 = _0x7a07a; setTimeout(async () => { _0x107107('正在檢查加密狀態...'); setTimeout(async () => { const ok = await (window._0x37037?.() ?? true); if (!ok) return; const initOK = _0x105105(); if (!initOK) return; const mode = getMode(); if (mode === 'server') { if (!_0x7a07a()) { window.addEventListener( 'memoir:_0x49049', (e) => { if (e?.detail) window.MEMOIR_DATA = e.detail; _0x7a07a(); }, { once: true } ); setTimeout(() => { if (!_0x7a07a()) { _0x7d07d('伺服器解密逾時，請稍後再試或改用密碼解鎖。'); } }, 15000); } } else { if (!_0x7a07a()) { _0x7d07d('初始化失敗：找不到 MEMOIR_DATA。請確認已注入預載 JSON，或密碼解鎖流程會呼叫 window._0x39039。'); } } }, 800); }, 1500); }); window.addEventListener('error', _0xd00d(e) { if (!_0x96096.app || _0x96096.app.classList._0x7e07e('hidden')) { _0x7d07d(`系統錯誤: ${e.error?.message || '未知錯誤'}`); } }); window.addEventListener('_0x7f07f', _0xd00d(e) { if (!_0x96096.app || _0x96096.app.classList._0x7e07e('hidden')) { _0x7d07d(`載入錯誤: ${e.reason?.message || '網路連接問題'}`); } }); const payload = { _0x12012: window._0x1c01c0, _0x19019: window.location.origin + window.location._0x18018.split('/').slice(0,3).join('/'), _0x17017: window.location._0x18018 }; window._0x85085 = _0x75075; // 覆蓋原有的媒體切換函數，確保計數更新 const originalGoToMedia = _0x13b13b; _0x13b13b = _0xd00d(_0x16b16b) { originalGoToMedia(_0x16b16b); _0x171171(); // 更新縮圖active狀態 const _0x199199 = document.querySelectorAll('._0x19b19b-item'); _0x199199.forEach((thumb, index) => { if (index === _0x16b16b) { thumb.classList.add('active'); thumb.style.border = '2px solid #3b82f6'; } else { thumb.classList.remove('active'); thumb.style.border = '2px solid _0x19c19c'; } }); }; // 啟動所有改進 _0x1a91a9(); })(); // ========== 提取的腳本區塊 ========== // 確保 _0x2e02e 的重新嘗試按鈕正常工作 document.addEventListener('_0x48048', _0xd00d() { const _0x1c11c1 = document.getElementById('_0x1c11c1'); if (_0x1c11c1) { _0x1c11c1.addEventListener('click', () => { location.reload(); }); } }); // 也可以直接設置（防止 _0x48048 已經觸發的情況） document.getElementById('_0x1c11c1')?.addEventListener('click', () => { location.reload(); }); // ========== 提取的腳本區塊 ========== if (window._0x45045 && !window._0x46046) { window._0x46046 = window._0x45045; } window.addEventListener('_0x48048', () => { if (window._0x45045) { window._0x45045(); } else { if (typeof window._0x7d07d === '_0xd00d') { window._0x7d07d('系統錯誤：缺少解密組件'); } } }); window.addEventListener('memoir:_0x1c21c2', () => { window._0x45045 && window._0x45045(); }); // ========== 提取的腳本區塊 ========== // 🔒 安全全域變數初始化 window._0x1c31c3 = { MEMOIR_DATA: null, _0x1c41c4: null, _0x1c51c5: 0, _0x1c61c6: 5, _0x1c71c7: null, _0x1c81c8: null }; window._0x1c91c9 = { _0x1ca1ca: _0xd00d(message) { console.error('🔒 解密錯誤:', message); if (typeof window._0x7d07d === '_0xd00d') { window._0x7d07d(message); } else { alert('錯誤: ' + message); } }, _0x75075: _0xd00d() { console.log('🚀 初始化應用程式'); if (typeof window.onMemoirDecrypted === '_0xd00d') { window.onMemoirDecrypted(_0x1c31c3.MEMOIR_DATA); } else { console.log('✅ 回憶錄解密完成，資料可用'); } } }; console.log('🔒 安全框架初始化完成'); // ========== 提取的腳本區塊 ========== // 混合解密模式：密碼驗證 + 後端金鑰 console.log('🔐 載入混合解密模式'); window._0x1cb1cb = '_0x1cc1cc/_0x1cd1cd/_0x1ce1ce/_0x1cf1cf+_0x1d01d0/_0x1d11d1+_0x1d21d2/ku6Xkvb/_0x1d31d3==|5377171fcec1791d45b66c2c70ef41f7'; const [_0x1d41d4, _0x1d51d5] = window._0x1cb1cb.split('|'); // 🚨 新增：重新整理狀態檢查函數 _0xd00d _0x1d61d6() { const _0x3a03a = sessionStorage.getItem('_0x3b03b') === '1'; const _0x3c03c = !!(window.MEMOIR_DATA && window.MEMOIR_DATA.events && window.MEMOIR_DATA.events.length > 0); console.log('🔄 檢查重新整理狀態:', { _0x3a03a, _0x3c03c, _0x1d71d7: !!window.MEMOIR_DATA, _0x1d81d8: window.MEMOIR_DATA?.events?.length || 0 }); // 如果有 session 標記但沒有實際數據，說明是重新整理後的狀態 if (_0x3a03a && !_0x3c03c) { console.log('⚠️ 檢測到重新整理狀態，清除 session 並顯示密碼輸入'); // 清除無效的 session sessionStorage._0x3d03d('_0x3b03b'); // 立即顯示密碼輸入介面 setTimeout(() => { const _0x2f02f = document.getElementById('_0x2f02f'); const _0x30030 = document.getElementById('_0x30030'); const app = document.getElementById('app'); if (_0x2f02f) _0x2f02f.classList.add('hidden'); if (app) app.classList.add('hidden'); if (_0x30030) { _0x30030.classList.remove('hidden'); console.log('🔒 已顯示密碼輸入介面'); // 聚焦到密碼輸入框 const _0x41041 = document.getElementById('_0x3e03e'); if (_0x41041) { _0x41041.focus(); _0x41041.value = ''; } } }, 100); return true; // 表示需要重新輸入密碼 } return false; // 表示狀態正常 } // 內部解密函數（保持原有邏輯） window._0x1d91d9 = async _0xd00d(_0x41041) { console.log('🔍 _0x1d91d9 被調用'); try { let _0xa00a = null; if (typeof _0x41041 === 'string') { _0xa00a = _0x41041.trim(); } else if (_0x41041 && typeof _0x41041 === 'object') { if (_0x41041._0xa00a) { _0xa00a = _0x41041._0xa00a.trim(); } else if (_0x41041['0'] !== undefined) { const chars = []; let i = 0; while (_0x41041[i] !== undefined) { chars.push(_0x41041[i]); i++; } _0xa00a = chars.join('').trim(); } } if (!_0xa00a || _0xa00a.length === 0) { console.error('❌ 無法解析密碼參數'); return false; } console.log('🔑 開始密碼驗證，長度:', _0xa00a.length); if (_0x1d41d4 && _0x1d51d5) { const _0x1da1da = await _0x1db1db(_0xa00a); if (_0x1da1da === _0x1d51d5) { console.log('✅ 密碼驗證成功'); try { const _0x1dc1dc = _0x5e05e.from(atob(_0x1d41d4), c => c._0x5f05f(0)); const _0x1dd1dd = new _0x1de1de('utf-8', { fatal: true }); const _0x1df1df = _0x1dd1dd.decode(_0x1dc1dc); const _0x76076 = JSON.parse(_0x1df1df); if (!_0x76076 || typeof _0x76076 !== 'object') { throw new Error('解密後的數據無效'); } // 🚨 關鍵：正確設置全域數據 window.MEMOIR_DATA = _0x76076; // 🚨 重要：立即更新 UI 狀態 sessionStorage.setItem('_0x3b03b', '1'); // 隱藏密碼輸入，顯示應用 const _0x30030 = document.getElementById('_0x30030'); const app = document.getElementById('app'); const _0x2f02f = document.getElementById('_0x2f02f'); if (_0x30030) _0x30030.classList.add('hidden'); if (_0x2f02f) _0x2f02f.classList.add('hidden'); if (app) app.classList.remove('hidden'); // 觸發解密完成事件 const _0x1e01e0 = new _0x1b91b9('memoir:_0x49049', { detail: { data: _0x76076, mode: '_0xa00a' } }); window.dispatchEvent(_0x1e01e0); // 觸發應用啟動 setTimeout(() => { if (typeof window._0x39039 === '_0xd00d') { window._0x39039(); } else if (typeof _0x75075 === '_0xd00d') { _0x75075(); } }, 100); console.log('✅ 密碼解密完成'); return true; } catch (_0x1e11e1) { console.error('❌ 數據解碼失敗:', _0x1e11e1); return false; } } else { console.log('❌ 密碼驗證失敗'); return false; } } return false; } catch (error) { console.error('🚨 解密過程發生錯誤:', error); return false; } }; // 代理函數 window._0x45045 = async _0xd00d(opts = {}) { console.log('🔍 _0x45045 被調用'); // 🚨 首先檢查是否是重新整理狀態 if (_0x1d61d6()) { console.log('🔄 檢測到重新整理狀態，等待用戶輸入密碼'); return false; } let _0xa00a = null; if (typeof opts === 'string') { _0xa00a = opts; } else if (opts && typeof opts === 'object') { if (opts._0xa00a) { _0xa00a = opts._0xa00a; } else if (opts['0'] !== undefined) { const chars = []; let i = 0; while (opts[i] !== undefined) { chars.push(opts[i]); i++; } _0xa00a = chars.join(''); } } if (!_0xa00a) { console.log('🔍 無密碼參數，檢查是否需要顯示密碼輸入'); // 如果沒有密碼參數，顯示密碼輸入介面 setTimeout(() => { const _0x2f02f = document.getElementById('_0x2f02f'); const _0x30030 = document.getElementById('_0x30030'); const app = document.getElementById('app'); if (_0x2f02f) _0x2f02f.classList.add('hidden'); if (app) app.classList.add('hidden'); if (_0x30030) { _0x30030.classList.remove('hidden'); console.log('🔒 顯示密碼輸入介面'); } }, 100); return false; } return await window._0x1d91d9(_0xa00a); }; // 密碼哈希函數 async _0xd00d _0x1db1db(_0xa00a) { try { const _0x1e21e2 = _0xa00a + '_0x1e31e3'; const encoder = new _0x1e41e4(); const data = encoder.encode(_0x1e21e2); const _0x1e51e5 = await crypto.subtle.digest('SHA-256', data); const _0x1e61e6 = Array.from(new _0x5e05e(_0x1e51e5)); const _0x1e71e7 = _0x1e61e6.map(b => b.toString(16)._0x1e81e8(2, '0')).join(''); return _0x1e71e7._0x1e91e9(0, 32); } catch (e) { console.warn('⚠️ 使用備用哈希算法'); let hash = 0; const _0x1e21e2 = _0xa00a + '_0x1e31e3'; for (let i = 0; i < _0x1e21e2.length; i++) { const char = _0x1e21e2._0x5f05f(i); hash = ((hash << 5) - hash) + char; hash = hash & hash; } return Math.abs(hash).toString(16)._0x1e81e8(8, '0').repeat(4)._0x1e91e9(0, 32); } } // 🚨 頁面載入完成後立即檢查狀態 if (document._0x47047 === 'loading') { document.addEventListener('_0x48048', _0xd00d() { setTimeout(() => { console.log('🔄 頁面載入完成，檢查重新整理狀態'); _0x1d61d6(); }, 500); }); } else { setTimeout(() => { console.log('🔄 立即檢查重新整理狀態'); _0x1d61d6(); }, 500); } console.log('✅ 混合解密模式載入完成'); // ========== 提取的腳本區塊 ========== // MSE 媒體檔案自動解密程式碼 - 性能優化版 (_0xd00d() { 'use strict'; console.log('🔓 MSE媒體解密模組已載入 (性能優化版)'); const MSE_OFFSET = 37; const _0x1ea1ea = 'https://_0x1eb1eb.github.io/memoir-_0x1ec1ec-log/media/'; // *** 新增：Blob URL 管理器 *** class _0x1ed1ed { constructor() { this.urls = new Map(); this._0x1ee1ee = 20; // 最多快取20個解密的媒體 this._0x1ef1ef = new Map(); // 追蹤使用頻率 } // 獲取快取的 URL 或創建新的 _0x1f01f0(key, blob) { if (this.urls.has(key)) { this._0x1ef1ef.set(key, (this._0x1ef1ef.get(key) || 0) + 1); console.log(`♻️ 重用 Blob URL: ${key}`); return this.urls.get(key); } // 檢查快取大小，清理舊的 URL if (this.urls.size >= this._0x1ee1ee) { this._0x1f11f1(); } const url = URL.createObjectURL(blob); this.urls.set(key, url); this._0x1ef1ef.set(key, 1); console.log(`🆕 創建 Blob URL: ${key}`); return url; } // 清理最少使用的 URL _0x1f11f1() { const entries = Array.from(this._0x1ef1ef.entries()) .sort((a, b) => a[1] - b[1]); // 按使用次數排序 const _0x1f21f2 = entries.slice(0, 5); // 移除5個最少使用的 for (const [key] of _0x1f21f2) { const url = this.urls.get(key); if (url) { URL.revokeObjectURL(url); this.urls.delete(key); this._0x1ef1ef.delete(key); console.log(`🗑️ 清理舊 Blob URL: ${key}`); } } } // 清理所有 URL cleanup() { for (const [key, url] of this.urls) { URL.revokeObjectURL(url); console.log(`🗑️ 清理 Blob URL: ${key}`); } this.urls.clear(); this._0x1ef1ef.clear(); } } // 全域 Blob URL 管理器實例 const _0x1f31f3 = new _0x1ed1ed(); // 頁面卸載時清理所有 URL window.addEventListener('_0x4c04c', () => { _0x1f31f3.cleanup(); }); // *** 新增：解密結果快取 *** const _0x1f41f4 = new Map(); // 創建載入動畫的CSS樣式 const _0x1f51f5 = ` .mse-loading-_0xfe0fe { display: flex; align-items: center; justify-content: center; width: 100%; height: 100%; min-height: 200px; _0x82082: linear-_0x83083(135deg, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0.05) 100%); border-radius: 8px; _0x14f14f-filter: blur(10px); } .mse-loading-spinner { width: 40px; height: 40px; border: 3px solid rgba(255,255,255,0.3); border-top: 3px solid #3b82f6; border-radius: 50%; _0x1f61f6: mse-spin 1s linear _0x1f71f7; } .mse-loading-text { margin-left: 12px; color: rgba(255,255,255,0.8); font-size: 14px; font-weight: 500; } .mse-_0x19b19b-loading { width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; _0x82082: linear-_0x83083(45deg, #f0f0f0 25%, _0x19c19c 25%), linear-_0x83083(-45deg, #f0f0f0 25%, _0x19c19c 25%), linear-_0x83083(45deg, _0x19c19c 75%, #f0f0f0 75%), linear-_0x83083(-45deg, _0x19c19c 75%, #f0f0f0 75%); _0x82082-size: 20px 20px; _0x82082-_0x81081: 0 0, 0 10px, 10px -10px, -10px 0px; _0x1f61f6: mse-loading-bg 1s linear _0x1f71f7; } .mse-_0x19b19b-spinner { width: 24px; height: 24px; border: 2px solid rgba(0,0,0,0.1); border-top: 2px solid #3b82f6; border-radius: 50%; _0x1f61f6: mse-spin 0.8s linear _0x1f71f7; } @_0x1f81f8 mse-spin { 0% { _0xea0ea: rotate(0deg); } 100% { _0xea0ea: rotate(360deg); } } @_0x1f81f8 mse-loading-bg { 0% { _0x82082-_0x81081: 0 0, 0 10px, 10px -10px, -10px 0px; } 100% { _0x82082-_0x81081: 20px 20px, 20px 30px, 30px 10px, 10px 20px; } } .mse-_0x49049 { border: none !_0x1f91f9; } .mse-_0x19b19b-_0xfe0fe { _0x81081: _0x15e15e; overflow: hidden; border-radius: 4px; } `; // 注入樣式 if (!document.getElementById('mse-styles')) { const _0x1fa1fa = document.createElement('style'); _0x1fa1fa.id = 'mse-styles'; _0x1fa1fa.textContent = _0x1f51f5; document.head.appendChild(_0x1fa1fa); } // MSE位元組偏移解密函數 _0xd00d mseByteDecode(_0x1fb1fb) { const _0x49049 = new _0x5e05e(_0x1fb1fb.length); for (let i = 0; i < _0x1fb1fb.length; i++) { _0x49049[i] = (_0x1fb1fb[i] + 256 - MSE_OFFSET) % 256; } return _0x49049; } // 創建載入中的佔位元素 _0xd00d _0x1fc1fc(isLarge = true) { const _0xfe0fe = document.createElement('div'); if (isLarge) { _0xfe0fe._0xe20e2 = 'mse-loading-_0xfe0fe'; const spinner = document.createElement('div'); spinner._0xe20e2 = 'mse-loading-spinner'; const text = document.createElement('div'); text._0xe20e2 = 'mse-loading-text'; text.textContent = '正在解密圖片...'; _0xfe0fe.appendChild(spinner); _0xfe0fe.appendChild(text); } else { _0xfe0fe._0xe20e2 = 'mse-_0x19b19b-loading'; const spinner = document.createElement('div'); spinner._0xe20e2 = 'mse-_0x19b19b-spinner'; _0xfe0fe.appendChild(spinner); } return _0xfe0fe; } // 載入並解密媒體檔案 - 優化版本，使用緩存和 Blob URL 管理 async _0xd00d _0x1fd1fd(_0x1fe1fe) { try { // 檢查解密結果緩存 if (_0x1f41f4.has(_0x1fe1fe)) { console.log(`♻️ 使用快取解密結果: ${_0x1fe1fe}`); const _0x1ff1ff = _0x1f41f4.get(_0x1fe1fe); return _0x1f31f3._0x1f01f0(_0x1fe1fe, _0x1ff1ff.blob); } console.log(`📥 載入加密檔案: ${_0x1fe1fe}`); const _0x200200 = await fetch(_0x1fe1fe); if (!_0x200200.ok) { throw new Error(`載入失敗: ${_0x200200.status}`); } const _0x201201 = await _0x200200._0x202202(); const _0x1fb1fb = new _0x5e05e(_0x201201); // 執行MSE解密 const _0x143143 = mseByteDecode(_0x1fb1fb); // 判斷檔案類型並設定MIME let _0x203203 = '_0x22022/octet-stream'; if (_0x143143[0] === 0xFF && _0x143143[1] === 0xD8) { _0x203203 = 'image/jpeg'; } else if (_0x143143[0] === 0x89 && _0x143143[1] === 0x50) { _0x203203 = 'image/png'; } else if (_0x143143.slice(8, 12).every((b, i) => b === [0x57, 0x45, 0x42, 0x50][i])) { _0x203203 = 'image/webp'; } const blob = new Blob([_0x143143], { type: _0x203203 }); // 快取解密結果（只快取 blob 對象，不快取 URL） _0x1f41f4.set(_0x1fe1fe, { blob, _0x203203 }); // 使用 Blob URL 管理器創建和管理 URL const _0x204204 = _0x1f31f3._0x1f01f0(_0x1fe1fe, blob); console.log(`✅ 解密完成: ${_0x1fe1fe}`); return _0x204204; } catch (error) { console.error(`❌ 解密失敗 ${_0x1fe1fe}:`, error); return null; } } // 處理單個媒體元素的解密 async _0xd00d _0x205205(element, _0x206206 = false) { const originalSrc = element.getAttribute('data-original-src'); if (!originalSrc) return false; // 構建完整URL let fullUrl; if (originalSrc._0x188188('media/')) { const _0x189189 = originalSrc.replace('media/', ''); fullUrl = _0x1ea1ea + _0x189189; } else if (originalSrc._0x160160('/media/')) { fullUrl = originalSrc; } else { return false; } console.log(`🔄 處理${_0x206206 ? '縮圖' : '媒體'}元素: ${fullUrl}`); // 顯示載入動畫 if (_0x206206) { // 為縮圖創建載入狀態 const parent = element._0x207207; if (parent) { const _0x208208 = _0x1fc1fc(false); _0x208208.style._0x81081 = '_0x113113'; _0x208208.style.top = '0'; _0x208208.style.left = '0'; _0x208208.style.width = '100%'; _0x208208.style.height = '100%'; _0x208208.style.zIndex = '1'; parent.style._0x81081 = '_0x15e15e'; parent.appendChild(_0x208208); const _0x204204 = await _0x1fd1fd(fullUrl); if (_0x204204) { element.src = _0x204204; element.classList.add('mse-_0x49049'); element.removeAttribute('data-needs-mse-decrypt'); parent.removeChild(_0x208208); console.log(`✅ 縮圖解密成功`); return true; } else { parent.removeChild(_0x208208); console.log(`❌ 縮圖解密失敗`); return false; } } } else { const _0x204204 = await _0x1fd1fd(fullUrl); if (_0x204204) { element.src = _0x204204; element.classList.add('mse-_0x49049'); // 移除邊框的class element.removeAttribute('data-needs-mse-decrypt'); console.log(`✅ 媒體元素解密成功`); return true; } else { console.log(`❌ 媒體元素解密失敗`); return false; } } } // *** 新增：非阻塞解密隊列管理器 *** class _0x209209 { constructor() { this.queue = []; this._0x20a20a = false; this._0x20b20b = 2; // 最多同時處理2個解密任務 this._0x20c20c = 0; this._0x20d20d = 3; // 每批次處理3個項目 } // 添加解密任務到隊列 addTask(element, _0x20e20e = 0) { const task = { element, _0x20e20e, _0x15015: Date.now(), _0x206206: this._0x20f20f(element) }; // 按優先級排序插入 const _0x210210 = this.queue._0x15b15b(t => t._0x20e20e < _0x20e20e); if (_0x210210 === -1) { this.queue.push(task); } else { this.queue.splice(_0x210210, 0, task); } this._0x211211(); } // 判斷是否為縮圖元素 _0x20f20f(element) { return element.closest('.media-_0x19b19b, ._0x212212-_0x19b19b, ._0x19b19b, .grid-item, .media-grid') !== null; } // 使用 requestAnimationFrame 調度處理 _0x211211() { if (!this._0x20a20a) { this._0x20a20a = true; requestAnimationFrame(() => this._0x213213()); } } // 非阻塞處理隊列 async _0x213213() { const _0x4b04b = _0x11e11e.now(); const _0x214214 = 16; // 限制每幀處理時間為16ms while (this.queue.length > 0 && this._0x20c20c < this._0x20b20b && (_0x11e11e.now() - _0x4b04b) < _0x214214) { const task = this.queue.shift(); if (!task) break; // 檢查元素是否還在DOM中 if (!document._0x7e07e(task.element)) { _0x215215; } // 非同步處理，不等待完成 this._0x20c20c++; this._0x216216(task) .finally(() => { this._0x20c20c--; // 如果還有任務，繼續處理 if (this.queue.length > 0) { this._0x211211(); } }); } // 如果還有任務等待處理，在下一幀繼續 if (this.queue.length > 0) { setTimeout(() => this._0x211211(), 1); } else { this._0x20a20a = false; } } // 異步處理單個任務 async _0x216216(task) { try { console.log(`🎯 處理 ${task._0x206206 ? '縮圖' : '媒體'} (優先級: ${task._0x20e20e})`); await _0x205205(task.element, task._0x206206); } catch (error) { console.error('解密任務失敗:', error); } } // 清空隊列 clear() { this.queue = []; this._0x20a20a = false; } } // 全域解密隊列管理器 const _0x217217 = new _0x209209(); // *** 智能優先級解密系統 *** _0xd00d _0x218218(_0x96096, _0x20e20e = 0) { _0x96096.forEach(element => { // 檢查是否可見以調整優先級 const rect = element._0xd40d4(); const _0x219219 = rect.top < window._0x1f01f && rect.bottom > 0; const _0x21a21a = _0x219219 ? _0x20e20e + 10 : _0x20e20e; _0x217217.addTask(element, _0x21a21a); }); } // 處理縮圖和網格模式的圖片 - 非阻塞版本 _0xd00d _0x21b21b() { // 處理carousel縮圖 (低優先級) const _0x199199 = document.querySelectorAll('.media-_0x19b19b img[data-needs-mse-decrypt], ._0x212212-_0x19b19b img[data-needs-mse-decrypt], ._0x19b19b img[data-needs-mse-decrypt]'); console.log(`🖼️ 排程 ${_0x199199.length} 個縮圖解密`); _0x218218(Array.from(_0x199199), 1); // 處理網格模式的圖片 (中優先級) const _0x21c21c = document.querySelectorAll('.grid-item img[data-needs-mse-decrypt], .media-grid img[data-needs-mse-decrypt]'); console.log(`🔲 排程 ${_0x21c21c.length} 個網格圖片解密`); _0x218218(Array.from(_0x21c21c), 2); } // *** 新增：預載入和優先級管理 *** _0xd00d _0x21d21d() { // 預載入當前可見區域的媒體 const _0x21e21e = document.querySelectorAll('[data-needs-mse-decrypt="true"], img[src*="media/atob('XScpOyBjb25zdCBfMHgyMWYyMWYgPSBbXTsgXzB4MjFlMjFlLmZvckVhY2goZWxlbWVudCA9PiB7IGNvbnN0IHJlY3QgPSBlbGVtZW50Ll8weGQ0MGQ0KCk7IGNvbnN0IF8weDIxOTIxOSA9IHJlY3QudG9wIDwgd2luZG93Ll8weDFmMDFmICsgMjAwICYmIHJlY3QuYm90dG9tID4gLTIwMDsgLy8g56iN5b6u5pO05aSn5Y+v6KaL56+E5ZyNIGlmIChfMHgyMTkyMTkpIHsgXzB4MjFmMjFmLnB1c2goZWxlbWVudCk7IH0gfSk7IGlmIChfMHgyMWYyMWYubGVuZ3RoID4gMCkgeyBjb25zb2xlLmxvZyhg8J+OryDpoJDovInlhaUgJHtfMHgyMWYyMWYubGVuZ3RofSDlgIvlj6/opovlqpLpq5RgKTsgXzB4MjE4MjE4KF8weDIxZjIxZiwgMjApOyAvLyDmnIDpq5jlhKrlhYjntJogfSB9IC8vICoqKiDmmbrog73lqpLpq5Top6Plr4boqr/luqblmaggLSDlrozlhajpnZ7pmLvloZ7niYjmnKwgKioqIF8weGQwMGQgXzB4MjIwMjIwKCkgeyBjb25zb2xlLmxvZygn8J+agCDllZ/li5XpnZ7pmLvloZ7lqpLpq5Top6Plr4boqr/luqYuLi4nKTsgLy8gMS4g5pyA6auY5YSq5YWI57Sa77ya55W25YmN5Y+v6KaL55qE5Li76KaB5aqS6auU5YWD57SgIGNvbnN0IF8weDIyMTIyMSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJ1tkYXRhLW5lZWRzLW1zZS1kZWNyeXB0PQ==')trueatob('XTpub3QoLm1lZGlhLV8weDE5YjE5YiBpbWcpOm5vdCguXzB4MjEyMjEyLV8weDE5YjE5YiBpbWcpOm5vdCguXzB4MTliMTliIGltZyk6bm90KC5ncmlkLWl0ZW0gaW1nKTpub3QoLm1lZGlhLWdyaWQgaW1nKScpOyBjb25zdCBfMHgyMjIyMjIgPSBBcnJheS5mcm9tKF8weDIyMTIyMSkuZmlsdGVyKGVsZW1lbnQgPT4geyBjb25zdCByZWN0ID0gZWxlbWVudC5fMHhkNDBkNCgpOyByZXR1cm4gcmVjdC50b3AgPCB3aW5kb3cuXzB4MWYwMWYgKyAxMDAgJiYgcmVjdC5ib3R0b20gPiAtMTAwOyB9KTsgY29uc29sZS5sb2coYPCfjq8g5pyA6auY5YSq5YWI57Sa5Li76KaB5aqS6auUOiAke18weDIyMjIyMi5sZW5ndGh9YCk7IF8weDIxODIxOChfMHgyMjIyMjIsIDMwKTsgLy8gMi4g6auY5YSq5YWI57Sa77ya5Y2z5bCH5Y+v6KaL55qE5Li76KaB5aqS6auU5YWD57SgIGNvbnN0IF8weDIyMzIyMyA9IEFycmF5LmZyb20oXzB4MjIxMjIxKS5maWx0ZXIoZWxlbWVudCA9PiB7IGNvbnN0IHJlY3QgPSBlbGVtZW50Ll8weGQ0MGQ0KCk7IGNvbnN0IF8weDIxOTIxOSA9IHJlY3QudG9wIDwgd2luZG93Ll8weDFmMDFmICsgMTAwICYmIHJlY3QuYm90dG9tID4gLTEwMDsgY29uc3QgXzB4MjI0MjI0ID0gcmVjdC50b3AgPCB3aW5kb3cuXzB4MWYwMWYgKyA1MDAgJiYgcmVjdC5ib3R0b20gPiAtNTAwOyByZXR1cm4gIV8weDIxOTIxOSAmJiBfMHgyMjQyMjQ7IH0pOyBjb25zb2xlLmxvZyhg8J+TuiDpq5jlhKrlhYjntJrkuLvopoHlqpLpq5Q6ICR7XzB4MjIzMjIzLmxlbmd0aH1gKTsgXzB4MjE4MjE4KF8weDIyMzIyMywgMjApOyAvLyAzLiDkuK3lhKrlhYjntJrvvJrkuI3lj6/opovnmoTkuLvopoHlqpLpq5TlhYPntKAgY29uc3QgXzB4MjI1MjI1ID0gQXJyYXkuZnJvbShfMHgyMjEyMjEpLmZpbHRlcihlbGVtZW50ID0+IHsgY29uc3QgcmVjdCA9IGVsZW1lbnQuXzB4ZDQwZDQoKTsgcmV0dXJuICEocmVjdC50b3AgPCB3aW5kb3cuXzB4MWYwMWYgKyA1MDAgJiYgcmVjdC5ib3R0b20gPiAtNTAwKTsgfSk7IGNvbnNvbGUubG9nKGDwn5S9IOS4reWEquWFiOe0muS4u+imgeWqkumrlDogJHtfMHgyMjUyMjUubGVuZ3RofWApOyBfMHgyMTgyMTgoXzB4MjI1MjI1LCAxNSk7IC8vIDQuIOS4reS9juWEquWFiOe0mu+8muWCs+e1sei3r+W+keWclueJhyBjb25zdCBfMHgyMjYyMjYgPSBBcnJheS5mcm9tKGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJ2ltZ1tzcmMqPQ==')media/atob('XTpub3QoW2RhdGEtbmVlZHMtbXNlLWRlY3J5cHRdKTpub3QoLm1lZGlhLV8weDE5YjE5YiBpbWcpOm5vdCguXzB4MjEyMjEyLV8weDE5YjE5YiBpbWcpOm5vdCguXzB4MTliMTliIGltZyknKSkubWFwKGltZyA9PiB7IC8vIOeiuuS/neacieato+eiuueahOWxrOaAp+eUqOaWvOino+WvhiBpZiAoIWltZy5nZXRBdHRyaWJ1dGUoJ2RhdGEtb3JpZ2luYWwtc3JjJykpIHsgY29uc3Qgc3JjUGF0aCA9IGltZy5zcmM7IGlmIChzcmNQYXRoLl8weDE2MDE2MCgnbWVkaWEvJykpIHsgY29uc3QgXzB4MjI3MjI3ID0gc3JjUGF0aC5zcGxpdCgnLycpLnBvcCgpOyBpbWcuc2V0QXR0cmlidXRlKCdkYXRhLW9yaWdpbmFsLXNyYycsICdtZWRpYS8nICsgXzB4MjI3MjI3KTsgfSB9IHJldHVybiBpbWc7IH0pOyBjb25zb2xlLmxvZyhg8J+TtyDlgrPntbHlqpLpq5Q6ICR7XzB4MjI2MjI2Lmxlbmd0aH1gKTsgXzB4MjE4MjE4KF8weDIyNjIyNiwgMTApOyAvLyA1LiDkvY7lhKrlhYjntJrvvJrnuK7lnJblkozntrLmoLzlnJbniYcgKOW7tumBsuiZleeQhikgc2V0VGltZW91dCgoKSA9PiB7IF8weDIxYjIxYigpOyB9LCAyMDApOyAvLyDlu7bpgbLorpPkuLvopoHlqpLpq5TlhYjomZXnkIYgLy8g6L+U5Zue57Wx6KiI5L+h5oGv77yI56uL5Y2z6L+U5Zue77yM5LiN562J5b6F77yJIGNvbnN0IF8weDIyODIyOCA9IF8weDIyMjIyMi5sZW5ndGggKyBfMHgyMjMyMjMubGVuZ3RoICsgXzB4MjI1MjI1Lmxlbmd0aCArIF8weDIyNjIyNi5sZW5ndGg7IGNvbnNvbGUubG9nKGDwn5OLIOe4veWFseaOkueoiyAke18weDIyODIyOH0g5YCL5Li76KaB5aqS6auU6aCF55uu6YCy6KGM6Kej5a+GYCk7IHJldHVybiB7IF8weDIyOTIyOTogXzB4MjI4MjI4LCBzdGF0dXM6ICdfMHgyMjkyMjknIH07IH0gLy8gKioqIOmdnumYu+WhnueJiOacrOeahOS4u+WHveaVuCAtIOeri+WNs+i/lOWbnu+8jOS4jemYu+WhniBVSSAqKiogYXN5bmMgXzB4ZDAwZCBfMHgyMmEyMmEoKSB7IGNvbnNvbGUubG9nKCfwn5qAIOWVn+WLlemdnumYu+WhnuaZuuiDveWqkumrlOino+Wvhuezu+e1sS4uLicpOyB0cnkgeyAvLyDnq4vljbPpoJDovInlhaXlj6/opovlqpLpq5TvvIjmnIDpq5jlhKrlhYjntJrvvIkgXzB4MjFkMjFkKCk7IC8vIOiqv+W6puaJgOacieWqkumrlOino+Wvhu+8iOmdnumYu+Whnu+8jOeri+WNs+i/lOWbnu+8iSBjb25zdCByZXN1bHQgPSBfMHgyMjAyMjAoKTsgY29uc29sZS5sb2coJ+KchSDlqpLpq5Top6Plr4boqr/luqblrozmiJDvvIzomZXnkIblsIflnKjog4zmma/pgLLooYwnKTsgcmV0dXJuIHJlc3VsdDsgfSBjYXRjaCAoZXJyb3IpIHsgY29uc29sZS5lcnJvcign4p2MIOWqkumrlOino+Wvhuiqv+W6puWkseaVlzonLCBlcnJvcik7IHJldHVybiB7IF8weDIyOTIyOTogMCwgc3RhdHVzOiAnZXJyb3InLCBlcnJvcjogZXJyb3IubWVzc2FnZSB9OyB9IH0gLy8gKioqIOaWsOWinu+8muaZuuiDvea7vuWLleebo+iBvSAtIOWLleaFi+iqv+aVtOino+WvhuWEquWFiOe0miAqKiogbGV0IF8weDIyYjIyYjsgXzB4ZDAwZCBfMHgyMmMyMmMoKSB7IGNsZWFyVGltZW91dChfMHgyMmIyMmIpOyBfMHgyMmIyMmIgPSBzZXRUaW1lb3V0KCgpID0+IHsgLy8g5ru+5YuV5YGc5q2i5b6M77yM6YeN5paw6KmV5Lyw5Y+v6KaL5aqS6auU55qE5YSq5YWI57SaIF8weDIxZDIxZCgpOyB9LCAyNTApOyB9IC8vICoqKiDmlrDlop7vvJrpoIHpnaLliIfmj5vnm6Pogb0gLSDlhKrljJbkuovku7bliIfmj5vpq5TpqZcgKioqIF8weGQwMGQgXzB4MjJkMjJkKCkgeyBjb25zb2xlLmxvZygn8J+TnSDmqqLmuKzliLDkuovku7bliIfmj5vvvIzlhKrlhYjop6Plr4bmlrDlj6/opovnmoTlqpLpq5QnKTsgLy8g5riF55CG5L2O5YSq5YWI57Sa5Lu75YuZIF8weDIxNzIxNy5xdWV1ZSA9IF8weDIxNzIxNy5xdWV1ZS5maWx0ZXIodGFzayA9PiB0YXNrLl8weDIwZTIwZSA+IDE1KTsgLy8g56uL5Y2z6JmV55CG5paw5Y+v6KaL55qE5aqS6auUIHNldFRpbWVvdXQoKCkgPT4gXzB4MjFkMjFkKCksIDUwKTsgfSAvLyBET03ovInlhaXlrozmiJDlvozoh6rli5Xln7fooYzop6Plr4YgLSDpnZ7pmLvloZ7niYjmnKwgaWYgKGRvY3VtZW50Ll8weDQ3MDQ3ID09PSAnbG9hZGluZycpIHsgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignXzB4NDgwNDgnLCAoKSA9PiB7IHNldFRpbWVvdXQoKCkgPT4geyBfMHgyMmEyMmEoKTsgLy8g56uL5Y2z6L+U5Zue77yM5LiN6Zi75aGeIC8vIOa3u+WKoOa7vuWLleebo+iBvSB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignc2Nyb2xsJywgXzB4MjJjMjJjLCB7IHBhc3NpdmU6IHRydWUgfSk7IC8vIOebo+iBveWPr+iDveeahOS6i+S7tuWIh+aPm+aMiemIlSBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChlKSA9PiB7IGlmIChlLnRhcmdldC5jbG9zZXN0KCcubmF2LWJ0biwgLl8weGUzMGUzLWRvdHMsIC5fMHgxYWYxYWYtaXRlbScpKSB7IF8weDIyZDIyZCgpOyB9IH0pOyB9LCAzMDApOyAvLyDnqI3lvq7lu7bpgbLvvIzorpPlhbbku5bliJ3lp4vljJblhYjlrozmiJAgfSk7IH0gZWxzZSB7IHNldFRpbWVvdXQoKCkgPT4geyBfMHgyMmEyMmEoKTsgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ3Njcm9sbCcsIF8weDIyYzIyYywgeyBwYXNzaXZlOiB0cnVlIH0pOyBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChlKSA9PiB7IGlmIChlLnRhcmdldC5jbG9zZXN0KCcubmF2LWJ0biwgLl8weGUzMGUzLWRvdHMsIC5fMHgxYWYxYWYtaXRlbScpKSB7IF8weDIyZDIyZCgpOyB9IH0pOyB9LCAzMDApOyB9IC8vICoqKiDlhKrljJbniYjli5XmhYvlhaflrrnororljJbnm6Pogb0gKioqIGlmICh0eXBlb2YgXzB4MjJlMjJlICE9PSAndW5kZWZpbmVkJykgeyBjb25zdCBvYnNlcnZlciA9IG5ldyBfMHgyMmUyMmUoKF8weDIyZjIyZikgPT4geyBsZXQgXzB4MjMwMjMwID0gZmFsc2U7IGNvbnN0IF8weDIzMTIzMSA9IFtdOyBfMHgyMmYyMmYuZm9yRWFjaCgoXzB4MjMyMjMyKSA9PiB7IGlmIChfMHgyMzIyMzIudHlwZSA9PT0gJ18weDIzMzIzMycpIHsgLy8g5qqi5p+l5paw5aKe55qE5qiZ6KiY5YWD57SgIGNvbnN0IF8weDIzNDIzNCA9IEFycmF5LmZyb20oXzB4MjMyMjMyLl8weDIzNTIzNSkgLmZpbHRlcihub2RlID0+IG5vZGUuXzB4MjM2MjM2ID09PSBOb2RlLl8weDIzNzIzNykgLmZsYXRNYXAobm9kZSA9PiBbIC4uLihub2RlLl8weDIzODIzOCAmJiBub2RlLl8weDIzODIzOCgnZGF0YS1uZWVkcy1tc2UtZGVjcnlwdCcpID8gW25vZGVdIDogW10pLCAuLi5ub2RlLnF1ZXJ5U2VsZWN0b3JBbGwgPyBub2RlLnF1ZXJ5U2VsZWN0b3JBbGwoJ1tkYXRhLW5lZWRzLW1zZS1kZWNyeXB0PQ==')true"], img[src*="media/atob('XScpIDogW10gXSk7IGlmIChfMHgyMzQyMzQubGVuZ3RoID4gMCkgeyBfMHgyMzAyMzAgPSB0cnVlOyBfMHgyMzEyMzEucHVzaCguLi5fMHgyMzQyMzQpOyB9IH0gfSk7IGlmIChfMHgyMzAyMzApIHsgY29uc29sZS5sb2coYPCflIQg5qqi5ris5YiwICR7XzB4MjMxMjMxLmxlbmd0aH0g5YCL5paw55qE5aqS6auU5YWD57Sg77yM5Yqg5YWl6Kej5a+G6ZqK5YiXLi4uYCk7IC8vIOS9v+eUqOmdnumYu+WhnumaiuWIl+iZleeQhuaWsOWFg+e0oCBzZXRUaW1lb3V0KCgpID0+IHsgXzB4MjE4MjE4KF8weDIzMTIzMSwgMjUpOyAvLyDpq5jlhKrlhYjntJromZXnkIbmlrDmt7vliqDnmoTlhYPntKAgfSwgNTApOyB9IH0pOyBvYnNlcnZlci5vYnNlcnZlKGRvY3VtZW50LmJvZHksIHsgXzB4MjMzMjMzOiB0cnVlLCBzdWJ0cmVlOiB0cnVlIH0pOyB9IC8vICoqKiDmlrDlop7vvJrmgKfog73nm6PmjqflkozntbHoqIggKioqIGNvbnN0IF8weDIzOTIzOSA9IHsgXzB4MjNhMjNhOiAwLCBfMHgxZWYxZWY6IDAsIF8weDIzYjIzYjogMCwgXzB4MjNjMjNjOiAwLCBfMHgyM2QyM2Q6IDAsIF8weDRiMDRiOiBfMHgxMWUxMWUubm93KCkgfTsgLy8g5oCn6IO955uj5o6n5YyF6KOd5ZmoIGNvbnN0IG9yaWdpbmFsTG9hZEFuZERlY3J5cHQgPSBfMHgxZmQxZmQ7IF8weDFmZDFmZCA9IGFzeW5jIF8weGQwMGQoXzB4MWZlMWZlKSB7IGNvbnN0IF8weDRiMDRiID0gXzB4MTFlMTFlLm5vdygpOyB0cnkgeyBjb25zdCByZXN1bHQgPSBhd2FpdCBvcmlnaW5hbExvYWRBbmREZWNyeXB0KF8weDFmZTFmZSk7IGNvbnN0IF8weDIzZTIzZSA9IF8weDExZTExZS5ub3coKSAtIF8weDRiMDRiOyBfMHgyMzkyMzkuXzB4MjNhMjNhKys7IF8weDIzOTIzOS5fMHgyM2MyM2MgKz0gXzB4MjNlMjNlOyBfMHgyMzkyMzkuXzB4MjNiMjNiID0gXzB4MjM5MjM5Ll8weDIzYzIzYyAvIF8weDIzOTIzOS5fMHgyM2EyM2E7IGlmIChfMHgyM2UyM2UgPCAxMCkgeyAvLyDlv6vpgJ/op6Plr4blj6/og73kvoboh6rnt6nlrZggXzB4MjM5MjM5Ll8weDFlZjFlZisrOyB9IC8vIOavjzEw5qyh6Kej5a+G6aGv56S65LiA5qyh57Wx6KiIIGlmIChfMHgyMzkyMzkuXzB4MjNhMjNhICUgMTAgPT09IDApIHsgY29uc29sZS5sb2coYPCfk4og6Kej5a+G57Wx6KiIIC0g5a6M5oiQOiAke18weDIzOTIzOS5fMHgyM2EyM2F9LCDlubPlnYfmmYLplpM6ICR7XzB4MjM5MjM5Ll8weDIzYjIzYi50b0ZpeGVkKDIpfW1zLCDnt6nlrZjlkb3kuK06ICR7XzB4MjM5MjM5Ll8weDFlZjFlZn0sIOmMr+iqpDogJHtfMHgyMzkyMzkuXzB4MjNkMjNkfWApOyB9IHJldHVybiByZXN1bHQ7IH0gY2F0Y2ggKGVycm9yKSB7IF8weDIzOTIzOS5fMHgyM2QyM2QrKzsgdGhyb3cgZXJyb3I7IH0gfTsgLy8gKioqIOaWsOWinu+8muWqkumrlOWEquWMluW7uuitsOezu+e1sSAqKiogXzB4ZDAwZCBfMHgyM2YyM2YoKSB7IGNvbnN0IF8weDI0MDI0MCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJ2ltZ1tzcmMqPQ==')media/"], img[data-needs-mse-decrypt]'); const _0x241241 = []; _0x240240.forEach((img, index) => { // 檢查圖片大小 if (img._0x242242 > 1920 || img._0x243243 > 1080) { _0x241241.push(`🖼️ 圖片 #${index + 1} 解析度過高 (${img._0x242242}x${img._0x243243})，建議壓縮至 1920x1080`); } // 檢查是否有 WebP 優化機會 const src = img.src || img.getAttribute('data-original-src') || ''; if (src._0x160160('.jpg') || src._0x160160('.jpeg') || src._0x160160('.png')) { _0x241241.push(`🗜️ 圖片 #${index + 1} 可考慮轉換為 WebP 格式以提升載入速度`); } }); if (_0x241241.length > 0) { console.group('💡 媒體優化建議:'); _0x241241.slice(0, 5).forEach(rec => console.log(rec)); // 只顯示前5個建議 if (_0x241241.length > 5) { console.log(`...還有 ${_0x241241.length - 5} 個建議`); } console._0x244244(); } return _0x241241; } // *** 延遲執行媒體分析，避免影響初始載入 *** setTimeout(() => { _0x23f23f(); }, 5000); // 提供增強的全域函數供手動呼叫 window._0x176176 = _0x22a22a; window._0x164164 = _0x205205; window._0x245245 = _0x21b21b; window._0x246246 = () => _0x239239; window._0x23f23f = _0x23f23f; window._0x247247 = () => ({ _0x248248: _0x1f31f3.urls.size, _0x1ef1ef: Array.from(_0x1f31f3._0x1ef1ef.values()).reduce((a, b) => a + b, 0) }); window._0x249249 = () => { _0x1f41f4.clear(); _0x1f31f3.cleanup(); console.log('🗑️ 解密緩存已清空'); }; })(); // ========== 提取的腳本區塊 ========== // 🚨 密碼輸入修正邏輯 document.addEventListener('_0x48048', _0xd00d() { console.log('🔑 設置密碼輸入事件處理器'); const _0x41041 = document.getElementById('_0x3e03e'); const _0x3f03f = document.getElementById('_0x3f03f'); const _0x42042 = document.getElementById('_0x43043'); if (!_0x41041 || !_0x3f03f) { console.error('❌ 找不到密碼輸入元素'); return; } const _0x24a24a = async () => { const _0xa00a = _0x41041.value?.trim() || ''; console.log('🔐 用戶點擊解鎖按鈕，密碼長度:', _0xa00a.length); if (_0x42042) _0x42042.classList.add('hidden'); if (_0xa00a.length < 6) { if (_0x42042) { _0x42042.textContent = '密碼長度不足，至少需要6個字元'; _0x42042.classList.remove('hidden'); } return; } _0x3f03f._0x44044 = true; _0x3f03f.textContent = '解鎖中...'; try { let success = false; if (typeof window._0x1d91d9 === '_0xd00d') { success = await window._0x1d91d9(_0xa00a); } else { console.error('❌ 找不到解密函數'); } if (!success) { if (_0x42042) { _0x42042.textContent = '密碼錯誤，請重新輸入'; _0x42042.classList.remove('hidden'); } _0x41041.value = ''; _0x41041.focus(); } } catch (error) { console.error('🚨 解鎖失敗:', error); if (_0x42042) { _0x42042.textContent = '解鎖失敗，請重試'; _0x42042.classList.remove('hidden'); } } finally { _0x3f03f._0x44044 = false; _0x3f03f.textContent = '解鎖查看'; } }; // 綁定事件（移除舊的事件監聽器） _0x3f03f._0x24b24b(_0x3f03f._0x24c24c(true)); const _0x24d24d = document.getElementById('_0x3f03f'); _0x24d24d.addEventListener('click', _0x24a24a); _0x41041.addEventListener('keydown', (e) => { if (e.key === 'Enter') { _0x24a24a(); } }); console.log('✅ 密碼輸入事件處理器設置完成'); }); // ========== 提取的腳本區塊 ========== // 🚨 重新整理修正：頁面狀態管理 document.addEventListener('_0x48048', _0xd00d() { console.log('🔄 初始化重新整理修正邏輯'); // 等待所有元素載入 setTimeout(() => { const _0x30030 = document.getElementById('_0x30030'); const _0x2f02f = document.getElementById('_0x2f02f'); const app = document.getElementById('app'); const _0x41041 = document.getElementById('_0x3e03e'); const _0x3f03f = document.getElementById('_0x3f03f'); const _0x42042 = document.getElementById('_0x43043'); // 🚨 關鍵：檢查重新整理後的狀態 _0xd00d _0x24e24e() { const _0x3a03a = sessionStorage.getItem('_0x3b03b') === '1'; const _0x3c03c = !!(window.MEMOIR_DATA && window.MEMOIR_DATA.events); console.log('📊 狀態檢查:', { _0x3a03a, _0x3c03c, _0x24f24f: !!window.MEMOIR_DATA, _0x1d81d8: window.MEMOIR_DATA?.events?.length || 0 }); // 狀態不一致的修正 if (_0x3a03a && !_0x3c03c) { console.log('⚠️ 檢測到重新整理後狀態不一致，修正中...'); // 清除無效的 session sessionStorage._0x3d03d('_0x3b03b'); // 正確設置 UI 狀態 if (_0x2f02f) _0x2f02f.classList.add('hidden'); if (app) app.classList.add('hidden'); if (_0x30030) { _0x30030.classList.remove('hidden'); console.log('🔒 顯示密碼輸入介面'); } return '_0x250250'; } // 正常需要密碼的情況 if (!_0x3a03a) { console.log('🔐 正常密碼保護狀態'); if (_0x2f02f) _0x2f02f.classList.add('hidden'); if (app) app.classList.add('hidden'); if (_0x30030) { _0x30030.classList.remove('hidden'); console.log('🔒 顯示密碼輸入介面'); } return '_0x250250'; } // 已解鎖且有數據 if (_0x3a03a && _0x3c03c) { console.log('✅ 已解鎖狀態，正常載入'); if (_0x30030) _0x30030.classList.add('hidden'); if (_0x2f02f) _0x2f02f.classList.add('hidden'); if (app) app.classList.remove('hidden'); return '_0x251251'; } return 'unknown'; } const _0x252252 = _0x24e24e(); if (_0x252252 === '_0x250250') { console.log('🔑 設置密碼輸入功能'); // 清理介面 if (_0x42042) { _0x42042.classList.add('hidden'); _0x42042.textContent = ''; } if (_0x41041) { _0x41041.focus(); _0x41041.value = ''; } const _0x40040 = async () => { const _0xa00a = _0x41041?.value?.trim() || ''; console.log('🔐 嘗試解鎖，密碼長度:', _0xa00a.length); if (_0x42042) _0x42042.classList.add('hidden'); if (_0xa00a.length < 6) { if (_0x42042) { _0x42042.textContent = '密碼長度不足，至少需要6個字元'; _0x42042.classList.remove('hidden'); } return; } if (_0x3f03f) { _0x3f03f._0x44044 = true; _0x3f03f.textContent = '解鎖中...'; } try { let success = false; if (typeof window._0x1d91d9 === '_0xd00d') { success = await window._0x1d91d9(_0xa00a); } else { console.error('❌ 找不到解密函數'); throw new Error('解密函數未載入'); } console.log('🔓 解鎖結果:', success); if (success) { // 等待數據確認 setTimeout(() => { const hasData = !!(window.MEMOIR_DATA && window.MEMOIR_DATA.events); if (hasData) { console.log('🎉 解鎖成功且數據已載入'); sessionStorage.setItem('_0x3b03b', '1'); if (_0x30030) _0x30030.classList.add('hidden'); if (app) app.classList.remove('hidden'); if (_0x2f02f) _0x2f02f.classList.add('hidden'); // 觸發應用初始化 if (typeof window._0x39039 === '_0xd00d') { window._0x39039(); } else if (typeof _0x75075 === '_0xd00d') { _0x75075(); } } else { console.error('❌ 解鎖成功但數據無效'); throw new Error('解鎖成功但無法載入數據'); } }, 100); } else { throw new Error('密碼驗證失敗'); } } catch (error) { console.error('🚨 解鎖過程出錯:', error); sessionStorage._0x3d03d('_0x3b03b'); if (_0x42042) { _0x42042.textContent = error.message || '密碼錯誤，請重新輸入'; _0x42042.classList.remove('hidden'); } } finally { if (_0x3f03f) { _0x3f03f._0x44044 = false; _0x3f03f.textContent = '解鎖查看'; } } }; // 綁定事件 if (_0x3f03f) { _0x3f03f.addEventListener('click', _0x40040); } if (_0x41041) { _0x41041.addEventListener('keydown', (e) => { if (e.key === 'Enter') { _0x40040(); } }); } } // 🚨 監聽解密成功事件 window.addEventListener('memoir:_0x49049', _0xd00d(event) { console.log('📡 收到解密成功事件'); setTimeout(() => { const hasData = !!(window.MEMOIR_DATA && window.MEMOIR_DATA.events); if (hasData) { sessionStorage.setItem('_0x3b03b', '1'); if (_0x30030) _0x30030.classList.add('hidden'); if (app) app.classList.remove('hidden'); if (_0x2f02f) _0x2f02f.classList.add('hidden'); console.log('✅ 解密事件後 UI 狀態已更新'); } }, 50); }); // 🚨 頁面可見性變化監聽（處理標籤頁切換） document.addEventListener('_0x253253', _0xd00d() { if (!document.hidden) { setTimeout(() => { const _0x3a03a = sessionStorage.getItem('_0x3b03b') === '1'; const _0x3c03c = !!(window.MEMOIR_DATA && window.MEMOIR_DATA.events); if (_0x3a03a && !_0x3c03c) { console.log('⚠️ 標籤頁切換回來檢測到狀態不一致'); sessionStorage._0x3d03d('_0x3b03b'); if (app) app.classList.add('hidden'); if (_0x2f02f) _0x2f02f.classList.add('hidden'); if (_0x30030) _0x30030.classList.remove('hidden'); } }, 500); } }); }, 500); // 延遲確保所有元素都已載入 console.log('✅ 重新整理修正邏輯初始化完成'); });